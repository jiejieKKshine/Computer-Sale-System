{"ast":null,"code":"/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _slicedToArray } from '../_chunks/dep-5efe53d1.mjs';\nimport { computed, watch, onMounted } from 'vue';\nimport '../_common/js/log/index.mjs';\nimport { limitUnicodeMaxLength, getCharacterLength, getUnicodeLength } from '../_common/js/utils/helper.mjs';\nimport { i as isNumber_1 } from '../_chunks/dep-889e457b.mjs';\nimport { i as isObject_1 } from '../_chunks/dep-2b09875b.mjs';\nimport log from '../_common/js/log/log.mjs';\nimport '../_chunks/dep-593f2b67.mjs';\nimport '../_chunks/dep-4a990ea3.mjs';\nimport '../_chunks/dep-5d3f7c0e.mjs';\nimport '../_chunks/dep-fa52aa21.mjs';\nimport '../_chunks/dep-4659d73b.mjs';\nimport '../_chunks/dep-03a7fb6c.mjs';\nimport '../_chunks/dep-eca422c3.mjs';\nimport '../_chunks/dep-bf7257e7.mjs';\nimport '../_chunks/dep-eae2a67e.mjs';\nimport '../_chunks/dep-626c497d.mjs';\nimport '../_chunks/dep-29ef8419.mjs';\nimport '../_chunks/dep-73384992.mjs';\nimport '../_chunks/dep-58a62202.mjs';\nfunction useLengthLimit(params) {\n  var getValueByLimitNumber = function getValueByLimitNumber(inputValue) {\n    var _params$value = params.value,\n      allowInputOverMax = _params$value.allowInputOverMax,\n      maxlength = _params$value.maxlength,\n      maxcharacter = _params$value.maxcharacter;\n    if (!(maxlength || maxcharacter) || allowInputOverMax || !inputValue) return inputValue;\n    if (maxlength) {\n      return limitUnicodeMaxLength(inputValue, maxlength);\n    }\n    if (maxcharacter) {\n      var r = getCharacterLength(inputValue, maxcharacter);\n      if (isObject_1(r)) {\n        return r.characters;\n      }\n    }\n  };\n  var limitNumber = computed(function () {\n    var _params$value2 = params.value,\n      maxlength = _params$value2.maxlength,\n      maxcharacter = _params$value2.maxcharacter,\n      value = _params$value2.value;\n    if (isNumber_1(value)) return String(value);\n    if (maxlength && maxcharacter) {\n      log.warn(\"Input\", \"Pick one of maxlength and maxcharacter please.\");\n    }\n    if (maxlength) {\n      var length = value !== null && value !== void 0 && value.length ? getUnicodeLength(value) : 0;\n      return \"\".concat(length, \"/\").concat(maxlength);\n    }\n    if (maxcharacter) {\n      return \"\".concat(getCharacterLength(value || \"\"), \"/\").concat(maxcharacter);\n    }\n    return \"\";\n  });\n  var innerStatus = computed(function () {\n    if (limitNumber.value) {\n      var _limitNumber$value$sp = limitNumber.value.split(\"/\"),\n        _limitNumber$value$sp2 = _slicedToArray(_limitNumber$value$sp, 2),\n        current = _limitNumber$value$sp2[0],\n        total = _limitNumber$value$sp2[1];\n      return Number(current) > Number(total) ? \"error\" : \"\";\n    }\n    return \"\";\n  });\n  var tStatus = computed(function () {\n    var status = params.value.status;\n    return status || innerStatus.value;\n  });\n  var onValidateChange = function onValidateChange() {\n    var _params$value$onValid, _params$value3;\n    (_params$value$onValid = (_params$value3 = params.value).onValidate) === null || _params$value$onValid === void 0 || _params$value$onValid.call(_params$value3, {\n      error: innerStatus.value ? \"exceed-maximum\" : void 0\n    });\n  };\n  watch(innerStatus, onValidateChange);\n  onMounted(function () {\n    innerStatus.value && onValidateChange();\n  });\n  return {\n    tStatus: tStatus,\n    limitNumber: limitNumber,\n    getValueByLimitNumber: getValueByLimitNumber\n  };\n}\nexport { useLengthLimit as default };","map":{"version":3,"names":["useLengthLimit","params","getValueByLimitNumber","inputValue","_params$value","value","allowInputOverMax","maxlength","maxcharacter","limitUnicodeMaxLength","r","getCharacterLength","isObject_1","characters","limitNumber","computed","_params$value2","isNumber_1","String","log","warn","length","getUnicodeLength","concat","innerStatus","_limitNumber$value$sp","split","_limitNumber$value$sp2","_slicedToArray","current","total","Number","tStatus","status","onValidateChange","_params$value$onValid","_params$value3","onValidate","call","error","watch","onMounted"],"sources":["../../src/input/useLengthLimit.tsx"],"sourcesContent":["import { computed, ComputedRef, onMounted, watch } from 'vue';\nimport { TdInputProps } from './type';\nimport log from '../_common/js/log';\nimport { getCharacterLength, getUnicodeLength, limitUnicodeMaxLength } from '../_common/js/utils/helper';\nimport isNumber from 'lodash/isNumber';\nimport isObject from 'lodash/isObject';\n\nexport interface UseLengthLimitParams {\n  value: string;\n  maxlength: number;\n  maxcharacter: number;\n  allowInputOverMax: boolean;\n  status: TdInputProps['status'];\n  onValidate: TdInputProps['onValidate'];\n}\n\nexport default function useLengthLimit(params: ComputedRef<UseLengthLimitParams>) {\n  // 文本超出数量限制时，是否允许继续输入\n  const getValueByLimitNumber = (inputValue: string) => {\n    const { allowInputOverMax, maxlength, maxcharacter } = params.value;\n    if (!(maxlength || maxcharacter) || allowInputOverMax || !inputValue) return inputValue;\n    if (maxlength) {\n      // input value could be unicode 😊\n      return limitUnicodeMaxLength(inputValue, maxlength);\n    }\n    if (maxcharacter) {\n      const r = getCharacterLength(inputValue, maxcharacter);\n      if (isObject(r)) {\n        return r.characters;\n      }\n    }\n  };\n\n  const limitNumber = computed(() => {\n    const { maxlength, maxcharacter, value } = params.value;\n    if (isNumber(value)) return String(value);\n    if (maxlength && maxcharacter) {\n      log.warn('Input', 'Pick one of maxlength and maxcharacter please.');\n    }\n    if (maxlength) {\n      const length = value?.length ? getUnicodeLength(value) : 0;\n      return `${length}/${maxlength}`;\n    }\n    if (maxcharacter) {\n      return `${getCharacterLength(value || '')}/${maxcharacter}`;\n    }\n    return '';\n  });\n\n  const innerStatus = computed(() => {\n    if (limitNumber.value) {\n      const [current, total] = limitNumber.value.split('/');\n      return Number(current) > Number(total) ? 'error' : '';\n    }\n    return '';\n  });\n\n  const tStatus = computed(() => {\n    const { status } = params.value;\n    return status || innerStatus.value;\n  });\n\n  const onValidateChange = () => {\n    params.value.onValidate?.({\n      error: innerStatus.value ? 'exceed-maximum' : undefined,\n    });\n  };\n\n  watch(innerStatus, onValidateChange);\n\n  onMounted(() => {\n    innerStatus.value && onValidateChange();\n  });\n\n  return {\n    tStatus,\n    limitNumber,\n    getValueByLimitNumber,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,SAAwBA,eAAeC,MAA2C;EAE1E,IAAAC,qBAAA,GAAwB,SAAxBA,sBAAyBC,UAAuB;IACpD,IAAAC,aAAA,GAAuDH,MAAO,CAAAI,KAAA;MAAtDC,iBAAA,GAAAF,aAAA,CAAAE,iBAAA;MAAmBC,SAAW,GAAAH,aAAA,CAAXG,SAAW;MAAAC,YAAA,GAAAJ,aAAA,CAAAI,YAAA;IACtC,IAAI,EAAED,SAAA,IAAaC,YAAiB,KAAAF,iBAAA,IAAqB,CAACH,UAAA,EAAmB,OAAAA,UAAA;IAC7E,IAAII,SAAW;MAEN,OAAAE,qBAAA,CAAsBN,UAAA,EAAYI,SAAS;IACpD;IACA,IAAIC,YAAc;MACV,IAAAE,CAAA,GAAIC,kBAAmB,CAAAR,UAAA,EAAYK,YAAY;MACjD,IAAAI,UAAA,CAASF,CAAC,CAAG;QACf,OAAOA,CAAE,CAAAG,UAAA;MACX;IACF;GACF;EAEM,IAAAC,WAAA,GAAcC,QAAA,CAAS,YAAM;IACjC,IAAAC,cAAA,GAA2Cf,MAAO,CAAAI,KAAA;MAA1CE,SAAA,GAAAS,cAAA,CAAAT,SAAA;MAAWC,YAAc,GAAAQ,cAAA,CAAdR,YAAc;MAAAH,KAAA,GAAAW,cAAA,CAAAX,KAAA;IACjC,IAAIY,UAAA,CAASZ,KAAK,GAAG,OAAOa,MAAA,CAAOb,KAAK;IACxC,IAAIE,SAAA,IAAaC,YAAc;MACzBW,GAAA,CAAAC,IAAA,CAAK,SAAS,gDAAgD;IACpE;IACA,IAAIb,SAAW;MACb,IAAMc,MAAS,GAAAhB,KAAA,aAAAA,KAAA,eAAAA,KAAA,CAAOgB,MAAS,GAAAC,gBAAA,CAAiBjB,KAAK,CAAI;MACzD,UAAAkB,MAAA,CAAUF,MAAU,OAAAE,MAAA,CAAAhB,SAAA;IACtB;IACA,IAAIC,YAAc;MAChB,UAAAe,MAAA,CAAUZ,kBAAA,CAAmBN,KAAS,MAAE,CAAK,OAAAkB,MAAA,CAAAf,YAAA;IAC/C;IACO;EACT,CAAC;EAEK,IAAAgB,WAAA,GAAcT,QAAA,CAAS,YAAM;IACjC,IAAID,WAAA,CAAYT,KAAO;MACrB,IAAAoB,qBAAA,GAAyBX,WAAY,CAAAT,KAAA,CAAMqB,KAAA,CAAM,GAAG;QAAAC,sBAAA,GAAAC,cAAA,CAAAH,qBAAA;QAA7CI,OAAS,GAAAF,sBAAA;QAAAG,KAAK,GAAAH,sBAAA;MACrB,OAAOI,MAAA,CAAOF,OAAO,IAAIE,MAAO,CAAAD,KAAK,IAAI,OAAU;IACrD;IACO;EACT,CAAC;EAEK,IAAAE,OAAA,GAAUjB,QAAA,CAAS,YAAM;IACvB,IAAEkB,MAAO,GAAIhC,MAAO,CAAAI,KAAA,CAAlB4B,MAAO;IACf,OAAOA,MAAA,IAAUT,WAAY,CAAAnB,KAAA;EAC/B,CAAC;EAED,IAAM6B,gBAAA,GAAmB,SAAnBA,iBAAA,EAAyB;IAAA,IAAAC,qBAAA,EAAAC,cAAA;IAC7B,CAAAD,qBAAA,IAAAC,cAAA,GAAAnC,MAAA,CAAOI,KAAA,EAAMgC,UAAa,cAAAF,qBAAA,KAA1B,UAAAA,qBAAA,CAAAG,IAAA,CAAAF,cAAA,EAA0B;MACxBG,KAAA,EAAOf,WAAY,CAAAnB,KAAA,GAAQ,gBAAmB;IAChD,CAAC;GACH;EAEAmC,KAAA,CAAMhB,WAAA,EAAaU,gBAAgB;EAEnCO,SAAA,CAAU,YAAM;IACdjB,WAAA,CAAYnB,KAAA,IAAS6B,gBAAiB;EACxC,CAAC;EAEM;IACLF,OAAA,EAAAA,OAAA;IACAlB,WAAA,EAAAA,WAAA;IACAZ,qBAAA,EAAAA;GACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}