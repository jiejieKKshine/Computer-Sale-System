{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\n/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _defineProperty } from '../_chunks/dep-fa52aa21.mjs';\nimport { i as isString_1 } from '../_chunks/dep-03a7fb6c.mjs';\nimport { i as isArray_1 } from '../_chunks/dep-eae2a67e.mjs';\nimport '../_chunks/dep-4659d73b.mjs';\nimport '../_chunks/dep-eca422c3.mjs';\nimport '../_chunks/dep-bf7257e7.mjs';\nimport '../_chunks/dep-626c497d.mjs';\nimport '../_chunks/dep-29ef8419.mjs';\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nvar downloadFile = function downloadFile(imgSrc) {\n  var _imgSrc$split, _imgSrc$split$split, _imgSrc$split$split$s;\n  var image = new Image();\n  var name = (imgSrc === null || imgSrc === void 0 || (_imgSrc$split = imgSrc.split) === null || _imgSrc$split === void 0 || (_imgSrc$split = _imgSrc$split.call(imgSrc, \"?\")) === null || _imgSrc$split === void 0 || (_imgSrc$split = _imgSrc$split[0]) === null || _imgSrc$split === void 0 || (_imgSrc$split$split = _imgSrc$split.split) === null || _imgSrc$split$split === void 0 || (_imgSrc$split$split = _imgSrc$split$split.call(_imgSrc$split, \"#\")) === null || _imgSrc$split$split === void 0 || (_imgSrc$split$split = _imgSrc$split$split[0]) === null || _imgSrc$split$split === void 0 || (_imgSrc$split$split$s = _imgSrc$split$split.split) === null || _imgSrc$split$split$s === void 0 ? void 0 : _imgSrc$split$split$s.call(_imgSrc$split$split, \"/\").pop()) || Math.random().toString(32).slice(2);\n  image.setAttribute(\"crossOrigin\", \"anonymous\");\n  image.onload = function () {\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = image.width;\n    canvas.height = image.height;\n    var context = canvas.getContext(\"2d\");\n    context.drawImage(image, 0, 0, image.width, image.height);\n    canvas.toBlob(function (blob) {\n      var url = URL.createObjectURL(blob);\n      var a = document.createElement(\"a\");\n      a.download = name;\n      a.href = url;\n      a.click();\n      a.remove();\n      URL.revokeObjectURL(url);\n    });\n  };\n  image.src = imgSrc;\n};\nvar isImageInfo = function isImageInfo(image) {\n  return !!image && !isString_1(image) && !(image instanceof File);\n};\nvar formatImages = function formatImages(images) {\n  if (!isArray_1(images)) return [];\n  return images.map(function (item) {\n    if (isImageInfo(item)) {\n      return _objectSpread({\n        download: true,\n        thumbnail: item.mainImage\n      }, item);\n    }\n    return {\n      mainImage: item,\n      thumbnail: item,\n      download: true\n    };\n  });\n};\nvar getOverlay = function getOverlay(props) {\n  if (props.showOverlay !== void 0) {\n    return props.showOverlay;\n  }\n  return props.mode === \"modal\";\n};\nexport { downloadFile, formatImages, getOverlay };","map":{"version":3,"names":["downloadFile","imgSrc","_imgSrc$split","_imgSrc$split$split","_imgSrc$split$split$s","image","Image","name","split","call","pop","Math","random","toString","slice","setAttribute","onload","canvas","document","createElement","width","height","context","getContext","drawImage","toBlob","blob","url","URL","createObjectURL","a","download","href","click","remove","revokeObjectURL","src","isImageInfo","isString_1","File","formatImages","images","isArray_1","map","item","_objectSpread","thumbnail","mainImage","getOverlay","props","showOverlay","mode"],"sources":["../../src/image-viewer/utils.ts"],"sourcesContent":["import isString from 'lodash/isString';\nimport isArray from 'lodash/isArray';\n\nimport { TdImageViewerProps, ImageInfo } from './type';\n\nexport const downloadFile = function (imgSrc: string) {\n  const image = new Image();\n  // fix #2935\n  // 当链接携带了参数时，需处理掉参数再取图片名称，否则扩展名会与参数链接导致原扩展名失效\n  // 例如：img.png?sign=xxx 不处理参数会被转成 img.png_sign=xxx\n  const name = imgSrc?.split?.('?')?.[0]?.split?.('#')?.[0]?.split?.('/').pop() || Math.random().toString(32).slice(2);\n\n  image.setAttribute('crossOrigin', 'anonymous');\n\n  image.onload = () => {\n    const canvas = document.createElement('canvas');\n    canvas.width = image.width;\n    canvas.height = image.height;\n\n    const context = canvas.getContext('2d');\n    context.drawImage(image, 0, 0, image.width, image.height);\n    canvas.toBlob((blob) => {\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.download = name;\n      a.href = url;\n      a.click();\n      a.remove();\n      URL.revokeObjectURL(url);\n    });\n  };\n  image.src = imgSrc;\n};\n\nconst isImageInfo = (image: string | File | ImageInfo): image is ImageInfo => {\n  return !!image && !isString(image) && !(image instanceof File);\n};\n\nexport const formatImages = (images: TdImageViewerProps['images']): ImageInfo[] => {\n  if (!isArray(images)) return [];\n  return images.map((item) => {\n    if (isImageInfo(item)) {\n      return {\n        download: true,\n        thumbnail: item.mainImage,\n        ...item,\n      };\n    }\n    return {\n      mainImage: item,\n      thumbnail: item,\n      download: true,\n    };\n  });\n};\n\nexport const getOverlay = (props: TdImageViewerProps) => {\n  if (props.showOverlay !== undefined) {\n    return props.showOverlay;\n  }\n  return props.mode === 'modal';\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAKaA,YAAA,GAAe,SAAfA,aAAyBC,MAAgB;EAAA,IAAAC,aAAA,EAAAC,mBAAA,EAAAC,qBAAA;EAC9C,IAAAC,KAAA,GAAQ,IAAIC,KAAM;EAIlB,IAAAC,IAAA,GAAO,CAAAN,MAAA,aAAAA,MAAA,gBAAAC,aAAA,GAAAD,MAAA,CAAQO,KAAQ,cAAAN,aAAA,gBAAAA,aAAA,GAAhBA,aAAA,CAAAO,IAAA,CAAAR,MAAA,EAAgB,GAAG,eAAAC,aAAA,gBAAAA,aAAA,GAAnBA,aAAA,CAAuB,CAAI,eAAAA,aAAA,gBAAAC,mBAAA,GAA3BD,aAAA,CAA2BM,KAAA,cAAAL,mBAAA,gBAAAA,mBAAA,GAA3BA,mBAAA,CAAAM,IAAA,CAAAP,aAAA,EAAmC,GAAG,eAAAC,mBAAA,gBAAAA,mBAAA,GAAtCA,mBAAA,CAA0C,CAAI,eAAAA,mBAAA,gBAAAC,qBAAA,GAA9CD,mBAAA,CAA8CK,KAAA,cAAAJ,qBAAA,uBAA9CA,qBAAA,CAAAK,IAAA,CAAAN,mBAAA,EAAsD,GAAG,CAAE,CAAAO,GAAA,OAASC,IAAK,CAAAC,MAAA,GAASC,QAAS,GAAE,CAAE,CAAAC,KAAA,CAAM,CAAC;EAE7GT,KAAA,CAAAU,YAAA,CAAa,eAAe,WAAW;EAE7CV,KAAA,CAAMW,MAAA,GAAS,YAAM;IACb,IAAAC,MAAA,GAASC,QAAS,CAAAC,aAAA,CAAc,QAAQ;IAC9CF,MAAA,CAAOG,KAAA,GAAQf,KAAM,CAAAe,KAAA;IACrBH,MAAA,CAAOI,MAAA,GAAShB,KAAM,CAAAgB,MAAA;IAEhB,IAAAC,OAAA,GAAUL,MAAO,CAAAM,UAAA,CAAW,IAAI;IACtCD,OAAA,CAAQE,SAAA,CAAUnB,KAAO,KAAG,GAAGA,KAAM,CAAAe,KAAA,EAAOf,KAAA,CAAMgB,MAAM;IACjDJ,MAAA,CAAAQ,MAAA,CAAO,UAACC,IAAS;MAChB,IAAAC,GAAA,GAAMC,GAAI,CAAAC,eAAA,CAAgBH,IAAI;MAC9B,IAAAI,CAAA,GAAIZ,QAAS,CAAAC,aAAA,CAAc,GAAG;MACpCW,CAAA,CAAEC,QAAW,GAAAxB,IAAA;MACbuB,CAAA,CAAEE,IAAO,GAAAL,GAAA;MACTG,CAAA,CAAEG,KAAM;MACRH,CAAA,CAAEI,MAAO;MACTN,GAAA,CAAIO,eAAA,CAAgBR,GAAG;IACzB,CAAC;GACH;EACAtB,KAAA,CAAM+B,GAAM,GAAAnC,MAAA;AACd;AAEA,IAAMoC,WAAA,GAAc,SAAdA,YAAehC,KAAyD;EACrE,QAAC,CAACA,KAAS,KAACiC,UAAA,CAASjC,KAAK,KAAK,EAAEA,KAAiB,YAAAkC,IAAA;AAC3D;IAEaC,YAAA,GAAe,SAAfA,aAAgBC,MAAsD;EAC7E,KAACC,SAAA,CAAQD,MAAM,GAAG,OAAO,EAAC;EACvB,OAAAA,MAAA,CAAOE,GAAI,WAACC,IAAS;IACtB,IAAAP,WAAA,CAAYO,IAAI,CAAG;MACd,OAAAC,aAAA;QACLd,QAAU;QACVe,SAAA,EAAWF,IAAK,CAAAG;MAAA,GACbH,IAAA;IAEP;IACO;MACLG,SAAW,EAAAH,IAAA;MACXE,SAAW,EAAAF,IAAA;MACXb,QAAU;KACZ;EACF,CAAC;AACH;IAEaiB,UAAA,GAAa,SAAbA,WAAcC,KAA8B;EACnD,IAAAA,KAAA,CAAMC,WAAA,KAAgB,KAAW;IACnC,OAAOD,KAAM,CAAAC,WAAA;EACf;EACA,OAAOD,KAAA,CAAME,IAAS;AACxB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}