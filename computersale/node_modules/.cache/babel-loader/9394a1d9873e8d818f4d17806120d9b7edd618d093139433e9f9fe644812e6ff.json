{"ast":null,"code":"import \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\n/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { a as _createClass, _ as _classCallCheck } from '../_chunks/dep-f909a041.mjs';\nimport { _ as _defineProperty } from '../_chunks/dep-fa52aa21.mjs';\nimport { ref, watch, onMounted, onBeforeUnmount, readonly } from 'vue';\nimport '../_chunks/dep-4659d73b.mjs';\nvar POPUP_BASE_Z_INDEX = 1e3;\nvar MESSAGE_BASE_Z_INDEX = 5e3;\nvar Z_INDEX_STEP = 1;\nvar PopupManager = /*#__PURE__*/_createClass(function PopupManager() {\n  var _this = this;\n  _classCallCheck(this, PopupManager);\n  _defineProperty(this, \"popupStack\", {\n    popup: /* @__PURE__ */new Set(),\n    dialog: /* @__PURE__ */new Set(),\n    message: /* @__PURE__ */new Set()\n  });\n  _defineProperty(this, \"getNextZIndex\", function (type) {\n    var current = type === \"message\" ? Array.from(_this.popupStack.message).pop() || MESSAGE_BASE_Z_INDEX : Array.from(_this.popupStack.popup).pop() || POPUP_BASE_Z_INDEX;\n    return current + Z_INDEX_STEP;\n  });\n  _defineProperty(this, \"add\", function (type) {\n    var zIndex = _this.getNextZIndex(type);\n    _this.popupStack[type].add(zIndex);\n    if (type === \"dialog\") {\n      _this.popupStack.popup.add(zIndex);\n    }\n    return zIndex;\n  });\n  _defineProperty(this, \"delete\", function (zIndex, type) {\n    _this.popupStack[type][\"delete\"](zIndex);\n    if (type === \"dialog\") {\n      _this.popupStack.popup[\"delete\"](zIndex);\n    }\n  });\n  _defineProperty(this, \"isLastDialog\", function (zIndex) {\n    if (_this.popupStack.dialog.size > 1) {\n      return zIndex === Array.from(_this.popupStack.dialog).pop();\n    }\n    return true;\n  });\n});\nvar popupManager = new PopupManager();\nfunction usePopupManager(type) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    visible = _ref.visible,\n    runOnMounted = _ref.runOnMounted;\n  var zIndex = ref(0);\n  var open = function open() {\n    zIndex.value = popupManager.add(type);\n  };\n  var close = function close() {\n    popupManager[\"delete\"](zIndex.value, type);\n  };\n  var isLastDialog = function isLastDialog() {\n    if (type === \"dialog\") {\n      return popupManager.isLastDialog(zIndex.value);\n    }\n    return false;\n  };\n  watch(function () {\n    return visible === null || visible === void 0 ? void 0 : visible.value;\n  }, function (visible2) {\n    if (visible2) {\n      open();\n    } else {\n      close();\n    }\n  }, {\n    immediate: true\n  });\n  if (runOnMounted) {\n    onMounted(function () {\n      open();\n    });\n    onBeforeUnmount(function () {\n      close();\n    });\n  }\n  return {\n    zIndex: readonly(zIndex),\n    open: open,\n    close: close,\n    isLastDialog: isLastDialog\n  };\n}\nexport { usePopupManager as default };","map":{"version":3,"names":["POPUP_BASE_Z_INDEX","MESSAGE_BASE_Z_INDEX","Z_INDEX_STEP","PopupManager","_createClass","_this","_classCallCheck","_defineProperty","popup","Set","dialog","message","type","current","Array","from","popupStack","pop","zIndex","getNextZIndex","add","size","popupManager","usePopupManager","_ref","arguments","length","undefined","visible","runOnMounted","ref","open","value","close","isLastDialog","watch","visible2","immediate","onMounted","onBeforeUnmount","readonly"],"sources":["../../src/hooks/usePopupManager.ts"],"sourcesContent":["// https://github.dev/arco-design/arco-design-vue\nimport { onMounted, onBeforeUnmount, readonly, Ref, ref, watch } from 'vue';\nexport type PopupType = 'popup' | 'dialog' | 'message';\n\nconst POPUP_BASE_Z_INDEX = 1000;\nconst MESSAGE_BASE_Z_INDEX = 5000;\nconst Z_INDEX_STEP = 1;\n\nclass PopupManager {\n  private popupStack = {\n    popup: new Set<number>(),\n    dialog: new Set<number>(),\n    message: new Set<number>(),\n  };\n\n  private getNextZIndex = (type: PopupType) => {\n    const current =\n      type === 'message'\n        ? Array.from(this.popupStack.message).pop() || MESSAGE_BASE_Z_INDEX\n        : Array.from(this.popupStack.popup).pop() || POPUP_BASE_Z_INDEX;\n    return current + Z_INDEX_STEP;\n  };\n\n  public add = (type: PopupType) => {\n    const zIndex = this.getNextZIndex(type);\n    this.popupStack[type].add(zIndex);\n    if (type === 'dialog') {\n      this.popupStack.popup.add(zIndex);\n    }\n    return zIndex;\n  };\n\n  public delete = (zIndex: number, type: PopupType) => {\n    this.popupStack[type].delete(zIndex);\n    if (type === 'dialog') {\n      this.popupStack.popup.delete(zIndex);\n    }\n  };\n\n  public isLastDialog = (zIndex: number) => {\n    if (this.popupStack.dialog.size > 1) {\n      return zIndex === Array.from(this.popupStack.dialog).pop();\n    }\n    return true;\n  };\n}\n\nconst popupManager = new PopupManager();\n\nexport default function usePopupManager(\n  type: PopupType,\n  {\n    visible,\n    runOnMounted,\n  }: {\n    visible?: Ref<boolean>;\n    runOnMounted?: boolean;\n  } = {},\n) {\n  const zIndex = ref(0);\n\n  const open = () => {\n    zIndex.value = popupManager.add(type);\n  };\n\n  const close = () => {\n    popupManager.delete(zIndex.value, type);\n  };\n\n  const isLastDialog = () => {\n    if (type === 'dialog') {\n      return popupManager.isLastDialog(zIndex.value);\n    }\n    return false;\n  };\n\n  watch(\n    () => visible?.value,\n    (visible) => {\n      if (visible) {\n        open();\n      } else {\n        close();\n      }\n    },\n    {\n      immediate: true,\n    },\n  );\n\n  if (runOnMounted) {\n    onMounted(() => {\n      open();\n    });\n\n    onBeforeUnmount(() => {\n      close();\n    });\n  }\n\n  return {\n    zIndex: readonly(zIndex),\n    open,\n    close,\n    isLastDialog,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}