{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_t_input = _resolveComponent(\"t-input\");\n  const _component_t_button = _resolveComponent(\"t-button\");\n  const _component_t_form_item = _resolveComponent(\"t-form-item\");\n  const _component_t_form = _resolveComponent(\"t-form\");\n  const _component_t_space = _resolveComponent(\"t-space\");\n  const _component_t_radio_button = _resolveComponent(\"t-radio-button\");\n  const _component_t_radio_group = _resolveComponent(\"t-radio-group\");\n  const _component_t_table = _resolveComponent(\"t-table\");\n  const _component_t_date_picker = _resolveComponent(\"t-date-picker\");\n  const _component_t_select = _resolveComponent(\"t-select\");\n  const _component_t_dialog = _resolveComponent(\"t-dialog\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createCommentVNode(\" 搜索框代码 \"), _createVNode(_component_t_space, {\n    direction: \"vertical\",\n    size: \"large\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_t_form, {\n      data: $setup.formData,\n      \"label-align\": $setup.formData.labelAlign,\n      \"label-width\": 60\n    }, {\n      default: _withCtx(() => [_createVNode(_component_t_form_item, {\n        label: \"维修单号\",\n        name: \"aid\",\n        style: {\n          \"display\": \"flex\",\n          \"align-items\": \"center\"\n        }\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_input, {\n          modelValue: $setup.formData.aid,\n          \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.formData.aid = $event),\n          style: {\n            \"flex-grow\": \"1\",\n            \"margin-right\": \"20px\"\n          }\n        }, null, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_t_button, {\n          theme: \"primary\",\n          type: \"submit\",\n          onClick: $setup.handleQuery\n        }, {\n          default: _withCtx(() => _cache[13] || (_cache[13] = [_createTextVNode(\"查询\")])),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"data\", \"label-align\"])]),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 维修单列表代码 \"), _createVNode(_component_t_space, {\n    direction: \"vertical\"\n  }, {\n    default: _withCtx(() => [_createCommentVNode(\" 按钮操作区域 \"), _createVNode(_component_t_radio_group, {\n      modelValue: $setup.size,\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.size = $event),\n      variant: \"default-filled\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_t_radio_button, {\n        value: \"medium\"\n      }, {\n        default: _withCtx(() => _cache[14] || (_cache[14] = [_createTextVNode(\"维修单列表\")])),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"modelValue\"]), _createCommentVNode(\" 当数据为空需要占位时，会显示 cellEmptyContent \"), _createVNode(_component_t_table, {\n      \"row-key\": \"index\",\n      data: $setup.data,\n      columns: $setup.columns,\n      stripe: $setup.stripe,\n      bordered: $setup.bordered,\n      hover: $setup.hover,\n      \"table-layout\": $setup.tableLayout ? 'auto' : 'fixed',\n      size: $setup.size,\n      pagination: $setup.pagination,\n      \"show-header\": $setup.showHeader,\n      \"cell-empty-content\": \"-\",\n      resizable: \"\",\n      \"lazy-load\": \"\",\n      onRowClick: $setup.handleRowClick\n    }, null, 8 /* PROPS */, [\"data\", \"columns\", \"stripe\", \"bordered\", \"hover\", \"table-layout\", \"size\", \"show-header\"])]),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 维修单编辑对话框 \"), _createVNode(_component_t_dialog, {\n    visible: $setup.visible,\n    \"onUpdate:visible\": _cache[10] || (_cache[10] = $event => $setup.visible = $event),\n    header: \"编辑维修单\",\n    width: \"60%\",\n    \"confirm-on-enter\": true,\n    \"on-cancel\": $setup.onCancel,\n    \"on-esc-keydown\": $setup.onEscKeydown,\n    \"on-close-btn-click\": $setup.onCloseBtnClick,\n    \"on-overlay-click\": $setup.onOverlayClick,\n    \"on-close\": $setup.close,\n    \"on-confirm\": $setup.onConfirm\n  }, {\n    default: _withCtx(() => [_createVNode(_component_t_space, {\n      direction: \"vertical\",\n      style: {\n        \"width\": \"100%\",\n        \"overflow\": \"auto\",\n        \"max-height\": \"400px\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_t_table, {\n        \"row-key\": \"index\",\n        data: $setup.orderDetail.items,\n        columns: $setup.orderColumns,\n        stripe: true,\n        bordered: true,\n        hover: true,\n        \"table-layout\": 'auto',\n        size: 'medium',\n        \"show-header\": true,\n        \"cell-empty-content\": \"-\",\n        resizable: \"\"\n      }, null, 8 /* PROPS */, [\"data\", \"columns\"]), _cache[15] || (_cache[15] = _createElementVNode(\"div\", {\n        style: {\n          \"text-align\": \"right\",\n          \"margin-top\": \"10px\"\n        }\n      }, [_createCommentVNode(\" <strong>订单总价: {{ orderDetail.total_price.toFixed(2) }}</strong> \")], -1 /* HOISTED */))]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_t_form, {\n      data: $setup.editFormData,\n      \"label-align\": 'right',\n      \"label-width\": 80\n    }, {\n      default: _withCtx(() => [_createVNode(_component_t_form_item, {\n        label: \"售后详细\",\n        name: \"sales_detail\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_input, {\n          modelValue: $setup.editFormData.sales_detail,\n          \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.editFormData.sales_detail = $event)\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_t_form_item, {\n        label: \"售后方式\",\n        name: \"way\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_input, {\n          modelValue: $setup.editFormData.way,\n          \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.editFormData.way = $event)\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_t_form_item, {\n        label: \"服务时间\",\n        name: \"service_time\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_date_picker, {\n          modelValue: $setup.editFormData.service_time,\n          \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $setup.editFormData.service_time = $event),\n          format: \"YYYY-MM-DD HH:mm:ss\"\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_t_form_item, {\n        label: \"职工号\",\n        name: \"eid\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_select, {\n          modelValue: $setup.editFormData.eid,\n          \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $setup.editFormData.eid = $event),\n          placeholder: \"请选择职工号\",\n          options: $setup.employeeNumberOptions,\n          onChange: $setup.onEmployeeNumberChange\n        }, null, 8 /* PROPS */, [\"modelValue\", \"options\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_t_form_item, {\n        label: \"职工名\",\n        name: \"ename\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_select, {\n          modelValue: $setup.editFormData.ename,\n          \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => $setup.editFormData.ename = $event),\n          placeholder: \"请选择职工名\",\n          options: $setup.employeeNameOptions,\n          onChange: $setup.onEmployeeNameChange\n        }, null, 8 /* PROPS */, [\"modelValue\", \"options\"])]),\n        _: 1 /* STABLE */\n      }), _cache[16] || (_cache[16] = _createElementVNode(\"div\", {\n        style: {\n          \"margin-top\": \"10px\",\n          \"color\": \"red\"\n        }\n      }, \"上门维修需加20元服务费\", -1 /* HOISTED */)), _createVNode(_component_t_form_item, {\n        label: \"成本费\",\n        name: \"cost\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_input, {\n          modelValue: $setup.editFormData.cost,\n          \"onUpdate:modelValue\": _cache[7] || (_cache[7] = $event => $setup.editFormData.cost = $event),\n          onInput: $setup.calculateProfit\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_t_form_item, {\n        label: \"服务费\",\n        name: \"service_fee\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_input, {\n          modelValue: $setup.editFormData.service_fee,\n          \"onUpdate:modelValue\": _cache[8] || (_cache[8] = $event => $setup.editFormData.service_fee = $event),\n          onInput: $setup.calculateProfit\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_t_form_item, {\n        label: \"利润\",\n        name: \"profit\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_t_input, {\n          modelValue: $setup.editFormData.profit,\n          \"onUpdate:modelValue\": _cache[9] || (_cache[9] = $event => $setup.editFormData.profit = $event),\n          disabled: \"\"\n        }, null, 8 /* PROPS */, [\"modelValue\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"data\"])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"visible\"]), _createCommentVNode(\" 成功提示对话框 \"), _createVNode(_component_t_dialog, {\n    visible: $setup.successVisible,\n    \"onUpdate:visible\": _cache[11] || (_cache[11] = $event => $setup.successVisible = $event),\n    header: \"提示\",\n    onClose: $setup.onSuccessClose\n  }, {\n    default: _withCtx(() => _cache[17] || (_cache[17] = [_createTextVNode(\" 确认成功！ \")])),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"visible\"]), _createCommentVNode(\" 失败提示对话框 \"), _createVNode(_component_t_dialog, {\n    visible: $setup.failureVisible,\n    \"onUpdate:visible\": _cache[12] || (_cache[12] = $event => $setup.failureVisible = $event),\n    header: \"提示\",\n    onClose: $setup.onFailureClose\n  }, {\n    default: _withCtx(() => _cache[18] || (_cache[18] = [_createTextVNode(\" 确认失败！ \")])),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"visible\"])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementBlock","_Fragment","_createCommentVNode","_createVNode","_component_t_space","direction","size","default","_withCtx","_component_t_form","data","$setup","formData","labelAlign","_component_t_form_item","label","name","style","_component_t_input","modelValue","aid","_cache","$event","_component_t_button","theme","type","onClick","handleQuery","_createTextVNode","_","_component_t_radio_group","variant","_component_t_radio_button","value","_component_t_table","columns","stripe","bordered","hover","tableLayout","pagination","showHeader","resizable","onRowClick","handleRowClick","_component_t_dialog","visible","header","width","onCancel","onEscKeydown","onCloseBtnClick","onOverlayClick","close","onConfirm","orderDetail","items","orderColumns","_createElementVNode","editFormData","sales_detail","way","_component_t_date_picker","service_time","format","_component_t_select","eid","placeholder","options","employeeNumberOptions","onChange","onEmployeeNumberChange","ename","employeeNameOptions","onEmployeeNameChange","cost","onInput","calculateProfit","service_fee","profit","disabled","successVisible","onClose","onSuccessClose","failureVisible","onFailureClose"],"sources":["E:\\三年级上册\\ComputerSale\\computersale\\src\\views\\MaintainComponent.vue"],"sourcesContent":["<template>\r\n  <!-- 搜索框代码 -->\r\n  <t-space direction=\"vertical\" size=\"large\">\r\n    <t-form :data=\"formData\" :label-align=\"formData.labelAlign\" :label-width=\"60\">\r\n      <t-form-item label=\"维修单号\" name=\"aid\" style=\"display: flex; align-items: center;\">\r\n        <t-input v-model=\"formData.aid\" style=\"flex-grow: 1; margin-right: 20px;\"></t-input>\r\n        <t-button theme=\"primary\" type=\"submit\" @click=\"handleQuery\">查询</t-button>\r\n      </t-form-item>\r\n    </t-form>\r\n  </t-space>\r\n\r\n  <!-- 维修单列表代码 -->\r\n  <t-space direction=\"vertical\">\r\n    <!-- 按钮操作区域 -->\r\n    <t-radio-group v-model=\"size\" variant=\"default-filled\">\r\n      <t-radio-button value=\"medium\">维修单列表</t-radio-button>\r\n    </t-radio-group>\r\n\r\n    <!-- 当数据为空需要占位时，会显示 cellEmptyContent -->\r\n    <t-table\r\n      row-key=\"index\"\r\n      :data=\"data\"\r\n      :columns=\"columns\"\r\n      :stripe=\"stripe\"\r\n      :bordered=\"bordered\"\r\n      :hover=\"hover\"\r\n      :table-layout=\"tableLayout ? 'auto' : 'fixed'\"\r\n      :size=\"size\"\r\n      :pagination=\"pagination\"\r\n      :show-header=\"showHeader\"\r\n      cell-empty-content=\"-\"\r\n      resizable\r\n      lazy-load\r\n      @row-click=\"handleRowClick\"\r\n    >\r\n    </t-table>\r\n  </t-space>\r\n\r\n  <!-- 维修单编辑对话框 -->\r\n  <t-dialog\r\n    v-model:visible=\"visible\"\r\n    header=\"编辑维修单\"\r\n    width=\"60%\"\r\n    :confirm-on-enter=\"true\"\r\n    :on-cancel=\"onCancel\"\r\n    :on-esc-keydown=\"onEscKeydown\"\r\n    :on-close-btn-click=\"onCloseBtnClick\"\r\n    :on-overlay-click=\"onOverlayClick\"\r\n    :on-close=\"close\"\r\n    :on-confirm=\"onConfirm\"\r\n  >\r\n    <t-space direction=\"vertical\" style=\"width: 100%; overflow: auto; max-height: 400px;\">\r\n      <t-table\r\n        row-key=\"index\"\r\n        :data=\"orderDetail.items\"\r\n        :columns=\"orderColumns\"\r\n        :stripe=\"true\"\r\n        :bordered=\"true\"\r\n        :hover=\"true\"\r\n        :table-layout=\"'auto'\"\r\n        :size=\"'medium'\"\r\n        :show-header=\"true\"\r\n        cell-empty-content=\"-\"\r\n        resizable\r\n      >\r\n      </t-table>\r\n      <div style=\"text-align: right; margin-top: 10px;\">\r\n        <!-- <strong>订单总价: {{ orderDetail.total_price.toFixed(2) }}</strong> -->\r\n      </div>\r\n    </t-space>\r\n\r\n    <t-form :data=\"editFormData\" :label-align=\"'right'\" :label-width=\"80\">\r\n      <t-form-item label=\"售后详细\" name=\"sales_detail\">\r\n        <t-input v-model=\"editFormData.sales_detail\"></t-input>\r\n      </t-form-item>\r\n      <t-form-item label=\"售后方式\" name=\"way\">\r\n        <t-input v-model=\"editFormData.way\"></t-input>\r\n      </t-form-item>\r\n      <t-form-item label=\"服务时间\" name=\"service_time\">\r\n        <t-date-picker v-model=\"editFormData.service_time\" format=\"YYYY-MM-DD HH:mm:ss\"></t-date-picker>\r\n      </t-form-item>\r\n      <t-form-item label=\"职工号\" name=\"eid\">\r\n        <t-select v-model=\"editFormData.eid\" placeholder=\"请选择职工号\" :options=\"employeeNumberOptions\" @change=\"onEmployeeNumberChange\"></t-select>\r\n      </t-form-item>\r\n      <t-form-item label=\"职工名\" name=\"ename\">\r\n        <t-select v-model=\"editFormData.ename\" placeholder=\"请选择职工名\" :options=\"employeeNameOptions\" @change=\"onEmployeeNameChange\"></t-select>\r\n      </t-form-item>\r\n      <div style=\"margin-top: 10px; color: red;\">上门维修需加20元服务费</div>\r\n      <t-form-item label=\"成本费\" name=\"cost\">\r\n        <t-input v-model=\"editFormData.cost\" @input=\"calculateProfit\"></t-input>\r\n      </t-form-item>\r\n      <t-form-item label=\"服务费\" name=\"service_fee\">\r\n        <t-input v-model=\"editFormData.service_fee\" @input=\"calculateProfit\"></t-input>\r\n      </t-form-item>\r\n      <t-form-item label=\"利润\" name=\"profit\">\r\n        <t-input v-model=\"editFormData.profit\" disabled></t-input>\r\n      </t-form-item>\r\n    </t-form>\r\n  </t-dialog>\r\n\r\n  <!-- 成功提示对话框 -->\r\n  <t-dialog v-model:visible=\"successVisible\" header=\"提示\" @close=\"onSuccessClose\">\r\n    确认成功！\r\n  </t-dialog>\r\n\r\n  <!-- 失败提示对话框 -->\r\n  <t-dialog v-model:visible=\"failureVisible\" header=\"提示\" @close=\"onFailureClose\">\r\n    确认失败！\r\n  </t-dialog>\r\n</template>\r\n\r\n<script setup lang=\"jsx\">\r\nimport { reactive, ref, onMounted } from 'vue';\r\nimport axios from 'axios';\r\nimport dayjs from 'dayjs';\r\n\r\nconst formData = reactive({\r\n  labelAlign: 'right',\r\n  aid: '',\r\n});\r\n\r\nconst data = ref([]);\r\nconst total = ref(0);\r\nconst editFormData = reactive({ sales_detail: '', way: '', service_time: '', eid: '', ename: '', cost: '', service_fee: '', profit: '' });\r\nconst orderDetail = ref({ items: [], total_price: 0 });\r\nconst visible = ref(false);\r\nconst successVisible = ref(false); // 成功提示对话框的显示状态\r\nconst failureVisible = ref(false); // 失败提示对话框的显示状态\r\n\r\nconst stripe = ref(true);\r\nconst bordered = ref(true);\r\nconst hover = ref(false);\r\nconst tableLayout = ref(false);\r\nconst size = ref('medium');\r\nconst showHeader = ref(true);\r\n\r\nconst columns = ref([\r\n  { colKey: 'aid', title: '维修单号', width: '100' },\r\n  { colKey: 'apply_time', title: '申请时间', width: '150' },\r\n  { colKey: 'oid', title: '关联订单号', width: '100' }, // 新增列\r\n  { colKey: 'cname', title: '顾客名', width: '80' },\r\n  { colKey: 'status', title: '订单状态', width: '100' },\r\n  { colKey: 'sales_detail', title: '售后详细', width: '150' },\r\n  { colKey: 'way', title: '售后方式', width: '100' },\r\n  { colKey: 'service_time', title: '服务时间', width: '150' },\r\n  { colKey: 'ename', title: '职工名', width: '100' },\r\n  { colKey: 'profit', title: '利润', width: '100' }, // 修改列标题为利润\r\n  { colKey: 'edit', title: '编辑信息', width: '100', cell: (h, { row }) => {\r\n    return <t-button theme=\"primary\" onClick={() => showEditDialog(row)}>编辑</t-button>;\r\n  }},\r\n  { colKey: 'confirm', title: '确认', width: '100', cell: (h, { row }) => {\r\n    return (\r\n      <t-button\r\n        theme=\"primary\"\r\n        disabled={row.status !== '待维修'}\r\n        onClick={() => confirmRepair(row.aid)}\r\n      >\r\n        确认\r\n      </t-button>\r\n    );\r\n  }},\r\n]);\r\n\r\nconst orderColumns = ref([\r\n  { colKey: 'pid', title: '产品号', width: '100' }, // 添加产品号列\r\n  { colKey: 'product_name', title: '商品名', width: '150' },\r\n  { colKey: 'unit_price', title: '单价', width: '100' },\r\n  { colKey: 'count', title: '数量', width: '100' },\r\n  { colKey: 'number', title: '商品库存', width: '100' },\r\n  { colKey: 'cost', title: '进价', width: '100' },\r\n  { colKey: 'warranty', title: '是否在保修期内', width: '150', cell: (h, { row }) => {\r\n    return row.warranty; // Display the warranty status\r\n  }},\r\n  { colKey: 'exchange_count', title: '更换数量', width: '100', cell: (h, { row }) => { // 添加更换数量列\r\n    return <t-input v-model={row.exchange_count} />;\r\n  }},\r\n]);\r\n\r\nconst handleRowClick = (e) => {\r\n  console.log(e);\r\n};\r\n\r\nconst pagination = {\r\n  defaultCurrent: 1,\r\n  defaultPageSize: 5,\r\n  total: total.value,\r\n};\r\n\r\nconst fetchData = async (aid = '') => {\r\n  try {\r\n    console.log('开始请求数据开始啦...');\r\n    const response = await axios.get(aid ? `/api/repairs/search` : `/api/repairs`, {\r\n      params: { aid }\r\n    });\r\n    console.log('请求数据成功:', response.data);\r\n    console.log(\"查询id:\", aid);\r\n    data.value = response.data;\r\n    total.value = response.data.length;\r\n    pagination.total = total.value;\r\n  } catch (error) {\r\n    console.error('请求数据失败:', error);\r\n  }\r\n};\r\n\r\nconst fetchEmployeeData = async () => {\r\n  try {\r\n    const response = await axios.get('/api/employee');\r\n    const employees = response.data;\r\n    employeeOptions.value = employees;\r\n    employeeNumberOptions.value = employees.map(emp => ({ label: emp.eid, value: emp.eid }));\r\n    employeeNameOptions.value = employees.map(emp => ({ label: emp.ename, value: emp.ename }));\r\n  } catch (error) {\r\n    console.error('获取员工数据失败:', error);\r\n  }\r\n};\r\n\r\nconst handleQuery = () => {\r\n  fetchData(formData.aid);\r\n};\r\n\r\nconst showEditDialog = async (row) => {\r\n  try {\r\n    const response = await axios.get(`/api/orders/content`, { params: { oid: row.oid } });\r\n    const applyTime = dayjs(row.apply_time);\r\n    console.log('申请时间:', applyTime.format('YYYY-MM-DD HH:mm:ss'));\r\n\r\n    orderDetail.value.items = response.data.map(item => {\r\n      console.log('下单时间:', item.order_time);\r\n      const orderTime = dayjs(item.order_time);\r\n      const warrantyPeriodYears = item.warranty_period;\r\n      console.log('订单保修期:', warrantyPeriodYears);\r\n      const warrantyEndDate = orderTime.add(warrantyPeriodYears, 'year');\r\n      console.log('保修期结束时间:', warrantyEndDate.format('YYYY-MM-DD HH:mm:ss'));\r\n\r\n      const isUnderWarranty = warrantyEndDate.isAfter(applyTime) ? '是' : '否';\r\n      // 保留上次更改的值\r\n      const existingItem = orderDetail.value.items.find(i => i.pid === item.pid);\r\n      const exchange_count = existingItem ? existingItem.exchange_count : 0;\r\n\r\n      return { ...item, warranty: isUnderWarranty, pid: item.pid, exchange_count };\r\n    });\r\n\r\n    console.log('订单详情:', orderDetail.value.items);\r\n  } catch (error) {\r\n    console.error('获取订单详细信息失败:', error);\r\n  }\r\n\r\n  await fetchEmployeeData();\r\n\r\n  editFormData.aid = row.aid;\r\n  editFormData.sales_detail = row.sales_detail;\r\n  editFormData.way = row.way;\r\n  editFormData.service_time = row.service_time;\r\n  editFormData.eid = row.eid;\r\n  editFormData.ename = row.ename;\r\n  editFormData.cost = row.cost;\r\n  editFormData.service_fee = row.service_fee;\r\n  editFormData.profit = row.profit;\r\n  visible.value = true;\r\n};\r\n\r\nconst confirmRepair = async (aid) => {\r\n  console.log('维修单已确认:', aid);\r\n\r\n  // 获取当前维修单的信息\r\n  const repairOrder = data.value.find(item => item.aid === aid);\r\n  console.log('维修单信息:', repairOrder);\r\n\r\n  // 获取并转换 service_time 格式\r\n  repairOrder.service_time = dayjs(repairOrder.service_time).format('YYYY-MM-DDTHH:mm:ss');\r\n\r\n  // 更新维修单状态为\"已维修\"\r\n  repairOrder.status = '已维修';\r\n\r\n  // 获取编辑表单里的商品pid和更换数量\r\n  const productUpdates = orderDetail.value.items.map(item => ({\r\n    pid: item.pid,\r\n    exchangeCount: parseInt(item.exchange_count, 10),\r\n  }));\r\n\r\n  try {\r\n    // 发送维修单信息到后端\r\n    console.log('维修单信息', repairOrder);\r\n    await axios.post('/api/repairs/update', repairOrder);\r\n\r\n    // 发送产品pid和更换数量到后端\r\n    console.log('啦啦啦维修单商品信息', productUpdates);\r\n    await axios.post('/api/product/update', productUpdates);\r\n\r\n    console.log('数据已成功发送到后端');\r\n    successVisible.value = true; // 显示成功提示对话框\r\n  } catch (error) {\r\n    console.error('发送数据到后端失败:', error);\r\n    failureVisible.value = true; // 显示失败提示对话框\r\n  }\r\n};\r\n\r\nconst onConfirm = () => {\r\n  console.log('编辑后的数据:', editFormData);\r\n  visible.value = false;\r\n  const index = data.value.findIndex(item => item.aid === editFormData.aid);\r\n  if (index !== -1) {\r\n    data.value[index] = { ...data.value[index], ...editFormData }; // 更新列表中的数据\r\n  }\r\n};\r\n\r\nconst onSuccessClose = () => {\r\n  successVisible.value = false;\r\n};\r\n\r\nconst onFailureClose = () => {\r\n  failureVisible.value = false;\r\n};\r\n\r\nconst employeeOptions = ref([]);\r\nconst employeeNumberOptions = ref([]);\r\nconst employeeNameOptions = ref([]);\r\n\r\nconst onEmployeeNumberChange = (value) => {\r\n  const selectedEmployee = employeeOptions.value.find(emp => emp.eid === value);\r\n  if (selectedEmployee) {\r\n    editFormData.ename = selectedEmployee.ename;\r\n  }\r\n};\r\n\r\nconst onEmployeeNameChange = (value) => {\r\n  const selectedEmployee = employeeOptions.value.find(emp => emp.ename === value);\r\n  if (selectedEmployee) {\r\n    editFormData.eid = selectedEmployee.eid;\r\n  }\r\n};\r\n\r\nconst close = (context) => {\r\n  console.log('关闭弹窗，点击关闭按钮、按下ESC、点击蒙层等触发', context);\r\n};\r\n\r\nconst onCancel = (context) => {\r\n  console.log('点击了取消按钮', context);\r\n};\r\n\r\nconst onEscKeydown = (context) => {\r\n  console.log('按下了ESC', context);\r\n};\r\n\r\nconst onCloseBtnClick = (context) => {\r\n  console.log('点击了关闭按钮', context);\r\n};\r\n\r\nconst onOverlayClick = (context) => {\r\n  console.log('点击了蒙层', context);\r\n};\r\n\r\n// 新增计算利润函数\r\nconst calculateProfit = () => {\r\n  editFormData.profit = (parseFloat(editFormData.service_fee) || 0) - (parseFloat(editFormData.cost) || 0);\r\n};\r\n\r\nonMounted(() => {\r\n  fetchData();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n/* 样式范围限定在当前组件 */\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}