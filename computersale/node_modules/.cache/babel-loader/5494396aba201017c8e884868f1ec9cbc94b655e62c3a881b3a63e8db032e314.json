{"ast":null,"code":"/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { ref, onMounted, onUnmounted } from 'vue';\nimport useKeepAnimation from './useKeepAnimation.mjs';\nimport { usePrefixClass } from './useConfig.mjs';\nimport setStyle from '../utils/set-style.mjs';\nimport '../_chunks/dep-1b9718a2.mjs';\nimport '../_chunks/dep-eca422c3.mjs';\nimport '../_chunks/dep-92f86d1d.mjs';\nimport '../_chunks/dep-6ab5363f.mjs';\nimport '../_chunks/dep-6dc3d0e1.mjs';\nimport '../_chunks/dep-06dcbf4c.mjs';\nimport '../_chunks/dep-bf7257e7.mjs';\nimport '../_chunks/dep-4659d73b.mjs';\nimport '../_chunks/dep-2b09875b.mjs';\nimport '../_chunks/dep-cda4f568.mjs';\nimport '../_chunks/dep-76958824.mjs';\nimport '../_chunks/dep-e9841b9e.mjs';\nimport '../_chunks/dep-1a4bb2f2.mjs';\nimport '../_chunks/dep-cc8ebcde.mjs';\nimport '../_chunks/dep-29ef8419.mjs';\nimport '../_chunks/dep-f5579c03.mjs';\nimport '../_chunks/dep-49aeee3c.mjs';\nimport '../_chunks/dep-b5bf85f5.mjs';\nimport '../_chunks/dep-3c65fae8.mjs';\nimport '../_chunks/dep-eae2a67e.mjs';\nimport '../_chunks/dep-626c497d.mjs';\nimport '../_chunks/dep-ec0bbd9f.mjs';\nimport '../_chunks/dep-e065dc25.mjs';\nimport '../_chunks/dep-400ec705.mjs';\nimport '../_chunks/dep-02f9394e.mjs';\nimport '../_chunks/dep-1725b1c7.mjs';\nimport '../_chunks/dep-532409c5.mjs';\nimport '../_common/js/global-config/default-config.mjs';\nimport '../_common/js/global-config/locale/zh_CN.mjs';\nimport '../_chunks/dep-9ed7da3e.mjs';\nimport '../_chunks/dep-7f65fc46.mjs';\nimport '../_chunks/dep-4f2cabb0.mjs';\nimport '../config-provider/useConfig.mjs';\nimport '../_chunks/dep-bb899bfd.mjs';\nimport '../_chunks/dep-5922c8f3.mjs';\nimport '../_chunks/dep-1b78414a.mjs';\nimport '../_chunks/dep-d84f19b3.mjs';\nimport '../_chunks/dep-732f0b7d.mjs';\nimport '../_chunks/dep-03a7fb6c.mjs';\nimport '../config-provider/type.mjs';\nvar period = 200;\nvar noneRippleBg = \"rgba(0, 0, 0, 0)\";\nvar defaultRippleColor = \"rgba(0, 0, 0, 0.35)\";\nvar getRippleColor = function getRippleColor(el, fixedRippleColor) {\n  var _el$dataset;\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  if (el !== null && el !== void 0 && (_el$dataset = el.dataset) !== null && _el$dataset !== void 0 && _el$dataset.ripple) {\n    var rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  var cssVariable = getComputedStyle(el).getPropertyValue(\"--ripple-color\");\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\nfunction useRipple(el, fixedRippleColor) {\n  var rippleContainer = ref(null);\n  var classPrefix = usePrefixClass();\n  var _useKeepAnimation = useKeepAnimation(),\n    keepRipple = _useKeepAnimation.keepRipple;\n  var handleAddRipple = function handleAddRipple(e) {\n    var dom = el.value;\n    var rippleColor = getRippleColor(dom, fixedRippleColor === null || fixedRippleColor === void 0 ? void 0 : fixedRippleColor.value);\n    if (e.button !== 0 || !el || !keepRipple) return;\n    if (dom.classList.contains(\"\".concat(classPrefix.value, \"-is-active\")) || dom.classList.contains(\"\".concat(classPrefix.value, \"-is-disabled\")) || dom.classList.contains(\"\".concat(classPrefix.value, \"-is-checked\")) || dom.classList.contains(\"\".concat(classPrefix.value, \"-is-loading\"))) return;\n    var elStyle = getComputedStyle(dom);\n    var elBorder = parseInt(elStyle.borderWidth, 10);\n    var border = elBorder > 0 ? elBorder : 0;\n    var width = dom.offsetWidth;\n    var height = dom.offsetHeight;\n    if (rippleContainer.value.parentNode === null) {\n      setStyle(rippleContainer.value, {\n        position: \"absolute\",\n        left: \"\".concat(0 - border, \"px\"),\n        top: \"\".concat(0 - border, \"px\"),\n        width: \"\".concat(width, \"px\"),\n        height: \"\".concat(height, \"px\"),\n        borderRadius: elStyle.borderRadius,\n        pointerEvents: \"none\",\n        overflow: \"hidden\"\n      });\n      dom.appendChild(rippleContainer.value);\n    }\n    var ripple = document.createElement(\"div\");\n    setStyle(ripple, {\n      marginTop: \"0\",\n      marginLeft: \"0\",\n      right: \"\".concat(width, \"px\"),\n      width: \"\".concat(width + 20, \"px\"),\n      height: \"100%\",\n      transition: \"transform \".concat(period, \"ms cubic-bezier(.38, 0, .24, 1), background \").concat(period * 2, \"ms linear\"),\n      transform: \"skewX(-8deg)\",\n      pointerEvents: \"none\",\n      position: \"absolute\",\n      zIndex: 0,\n      backgroundColor: rippleColor,\n      opacity: \"0.9\"\n    });\n    var elMap = /* @__PURE__ */new WeakMap();\n    for (var n = dom.children.length, i = 0; i < n; ++i) {\n      var child = dom.children[i];\n      if (child.style.zIndex === \"\" && child !== rippleContainer.value) {\n        child.style.zIndex = \"1\";\n        elMap.set(child, true);\n      }\n    }\n    var initPosition = dom.style.position ? dom.style.position : getComputedStyle(dom).position;\n    if (initPosition === \"\" || initPosition === \"static\") {\n      dom.style.position = \"relative\";\n    }\n    rippleContainer.value.insertBefore(ripple, rippleContainer.value.firstChild);\n    setTimeout(function () {\n      ripple.style.transform = \"translateX(\".concat(width, \"px)\");\n    }, 0);\n    var _handleClearRipple = function handleClearRipple() {\n      ripple.style.backgroundColor = noneRippleBg;\n      if (!el.value) return;\n      el.value.removeEventListener(\"pointerup\", _handleClearRipple, false);\n      el.value.removeEventListener(\"pointerleave\", _handleClearRipple, false);\n      setTimeout(function () {\n        ripple.remove();\n        if (rippleContainer.value.children.length === 0) rippleContainer.value.remove();\n      }, period * 2 + 100);\n    };\n    el.value.addEventListener(\"pointerup\", _handleClearRipple, false);\n    el.value.addEventListener(\"pointerleave\", _handleClearRipple, false);\n  };\n  onMounted(function () {\n    var dom = el === null || el === void 0 ? void 0 : el.value;\n    if (!dom) return;\n    rippleContainer.value = document.createElement(\"div\");\n    dom.addEventListener(\"pointerdown\", handleAddRipple, false);\n  });\n  onUnmounted(function () {\n    var _el$value;\n    el === null || el === void 0 || (_el$value = el.value) === null || _el$value === void 0 || _el$value.removeEventListener(\"pointerdown\", handleAddRipple, false);\n  });\n}\nexport { useRipple as default };","map":{"version":3,"names":["period","noneRippleBg","defaultRippleColor","getRippleColor","el","fixedRippleColor","_el$dataset","dataset","ripple","rippleColor","cssVariable","getComputedStyle","getPropertyValue","useRipple","rippleContainer","ref","classPrefix","usePrefixClass","_useKeepAnimation","useKeepAnimation","keepRipple","handleAddRipple","e","dom","value","button","classList","contains","concat","elStyle","elBorder","parseInt","borderWidth","border","width","offsetWidth","height","offsetHeight","parentNode","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","document","createElement","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","style","set","initPosition","insertBefore","firstChild","setTimeout","_handleClearRipple","handleClearRipple","removeEventListener","remove","addEventListener","onMounted","onUnmounted","_el$value"],"sources":["../../src/hooks/useRipple.ts"],"sourcesContent":["import { ref, onMounted, onUnmounted, Ref } from 'vue';\nimport useKeepAnimation from './useKeepAnimation';\nimport { usePrefixClass } from './useConfig';\nimport setStyle from '../utils/set-style';\n\nconst period = 200;\nconst noneRippleBg = 'rgba(0, 0, 0, 0)';\nconst defaultRippleColor = 'rgba(0, 0, 0, 0.35)';\n\n// 设置动画颜色 get the ripple animation color\nconst getRippleColor = (el: HTMLElement, fixedRippleColor?: string) => {\n  // get fixed color from params\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  // get dynamic color from the dataset\n  if (el?.dataset?.ripple) {\n    const rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  // use css variable\n  const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\n\n/**\n * 斜八角动画hooks 支持三种方式使用\n * 1. fixedRippleColor 固定色值 useRipple(ref,fixedRippleColor);\n * 2. dynamicColor 动态色值 data.ripple=\"rippleColor\" useRipple(ref)\n * 3. CSS variables（recommended） 配合节点对应CSS设置 --ripple-color useRipple(ref)\n * @param ref 需要使用斜八角动画的DOM\n * @param fixedRippleColor 斜八角的动画颜色\n */\nexport default function useRipple(el: Ref<HTMLElement>, fixedRippleColor?: Ref<string>) {\n  const rippleContainer = ref(null);\n  const classPrefix = usePrefixClass();\n\n  // 全局配置ripple\n  const { keepRipple } = useKeepAnimation();\n\n  // 为节点添加斜八角动画 add ripple to the DOM and set up the animation\n  const handleAddRipple = (e: MouseEvent) => {\n    const dom = el.value;\n    const rippleColor = getRippleColor(dom, fixedRippleColor?.value);\n    if (e.button !== 0 || !el || !keepRipple) return;\n\n    if (\n      dom.classList.contains(`${classPrefix.value}-is-active`) ||\n      dom.classList.contains(`${classPrefix.value}-is-disabled`) ||\n      dom.classList.contains(`${classPrefix.value}-is-checked`) ||\n      dom.classList.contains(`${classPrefix.value}-is-loading`)\n    )\n      return;\n\n    const elStyle = getComputedStyle(dom);\n\n    const elBorder = parseInt(elStyle.borderWidth, 10);\n    const border = elBorder > 0 ? elBorder : 0;\n    const width = dom.offsetWidth;\n    const height = dom.offsetHeight;\n\n    if (rippleContainer.value.parentNode === null) {\n      setStyle(rippleContainer.value, {\n        position: 'absolute',\n        left: `${0 - border}px`,\n        top: `${0 - border}px`,\n        width: `${width}px`,\n        height: `${height}px`,\n        borderRadius: elStyle.borderRadius,\n        pointerEvents: 'none',\n        overflow: 'hidden',\n      });\n      dom.appendChild(rippleContainer.value);\n    }\n    // 新增一个ripple\n    const ripple = document.createElement('div');\n\n    setStyle(ripple, {\n      marginTop: '0',\n      marginLeft: '0',\n      right: `${width}px`,\n      width: `${width + 20}px`,\n      height: '100%',\n      transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n      transform: 'skewX(-8deg)',\n      pointerEvents: 'none',\n      position: 'absolute',\n      zIndex: 0,\n      backgroundColor: rippleColor,\n      opacity: '0.9',\n    });\n\n    // fix zIndex：避免遮盖内部元素\n    const elMap = new WeakMap();\n    for (let n = dom.children.length, i = 0; i < n; ++i) {\n      const child = dom.children[i];\n      if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer.value) {\n        (child as HTMLElement).style.zIndex = '1';\n        elMap.set(child, true);\n      }\n    }\n\n    // fix position\n    const initPosition = dom.style.position ? dom.style.position : getComputedStyle(dom).position;\n    if (initPosition === '' || initPosition === 'static') {\n      // eslint-disable-next-line no-param-reassign\n      dom.style.position = 'relative';\n    }\n    rippleContainer.value.insertBefore(ripple, rippleContainer.value.firstChild);\n\n    setTimeout(() => {\n      ripple.style.transform = `translateX(${width}px)`;\n    }, 0);\n    // 清除动画节点 clear ripple container\n    const handleClearRipple = () => {\n      ripple.style.backgroundColor = noneRippleBg;\n\n      if (!el.value) return;\n\n      el.value.removeEventListener('pointerup', handleClearRipple, false);\n      el.value.removeEventListener('pointerleave', handleClearRipple, false);\n\n      setTimeout(() => {\n        ripple.remove();\n        if (rippleContainer.value.children.length === 0) rippleContainer.value.remove();\n      }, period * 2 + 100);\n    };\n    el.value.addEventListener('pointerup', handleClearRipple, false);\n    el.value.addEventListener('pointerleave', handleClearRipple, false);\n  };\n\n  onMounted(() => {\n    const dom = el?.value;\n    if (!dom) return;\n\n    rippleContainer.value = document.createElement('div');\n\n    dom.addEventListener('pointerdown', handleAddRipple, false);\n  });\n\n  onUnmounted(() => {\n    el?.value?.removeEventListener('pointerdown', handleAddRipple, false);\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}