{"ast":null,"code":"/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { computed, onMounted, onBeforeUnmount } from 'vue';\nimport useVirtualScroll from '../../hooks/useVirtualScroll.mjs';\nimport '../../_chunks/dep-fa52aa21.mjs';\nimport '../../_chunks/dep-4659d73b.mjs';\nvar usePanelVirtualScroll = function usePanelVirtualScroll(props) {\n  var _props$scroll3, _props$scroll4, _props$scroll5, _props$scroll6, _props$scroll7;\n  var isVirtual = computed(function () {\n    var _props$scroll, _props$options$value, _props$scroll2;\n    return ((_props$scroll = props.scroll) === null || _props$scroll === void 0 ? void 0 : _props$scroll.type) === \"virtual\" && ((_props$options$value = props.options.value) === null || _props$options$value === void 0 ? void 0 : _props$options$value.length) > (((_props$scroll2 = props.scroll) === null || _props$scroll2 === void 0 ? void 0 : _props$scroll2.threshold) || 100);\n  });\n  var _ref = ((_props$scroll3 = props.scroll) === null || _props$scroll3 === void 0 ? void 0 : _props$scroll3.type) === \"virtual\" ? useVirtualScroll({\n      container: props.popupContentRef,\n      data: props.options,\n      fixedHeight: ((_props$scroll4 = props.scroll) === null || _props$scroll4 === void 0 ? void 0 : _props$scroll4.isFixedRowHeight) || false,\n      lineHeight: ((_props$scroll5 = props.scroll) === null || _props$scroll5 === void 0 ? void 0 : _props$scroll5.rowHeight) || 28,\n      bufferSize: ((_props$scroll6 = props.scroll) === null || _props$scroll6 === void 0 ? void 0 : _props$scroll6.bufferSize) || 20,\n      threshold: ((_props$scroll7 = props.scroll) === null || _props$scroll7 === void 0 ? void 0 : _props$scroll7.threshold) || 100\n    }) : {},\n    _ref$trs = _ref.trs,\n    trs = _ref$trs === void 0 ? null : _ref$trs,\n    _ref$visibleData = _ref.visibleData,\n    visibleData = _ref$visibleData === void 0 ? null : _ref$visibleData,\n    _ref$handleScroll = _ref.handleScroll,\n    handleVirtualScroll = _ref$handleScroll === void 0 ? null : _ref$handleScroll,\n    _ref$scrollHeight = _ref.scrollHeight,\n    scrollHeight = _ref$scrollHeight === void 0 ? null : _ref$scrollHeight,\n    _ref$translateY = _ref.translateY,\n    translateY = _ref$translateY === void 0 ? null : _ref$translateY,\n    _ref$handleRowMounted = _ref.handleRowMounted,\n    handleRowMounted = _ref$handleRowMounted === void 0 ? null : _ref$handleRowMounted;\n  var lastScrollY = -1;\n  var onInnerVirtualScroll = function onInnerVirtualScroll(e) {\n    if (!isVirtual.value) {\n      return;\n    }\n    var target = e.target;\n    var top = target.scrollTop;\n    if (Math.abs(lastScrollY - top) > 5) {\n      handleVirtualScroll();\n      lastScrollY = top;\n    } else {\n      lastScrollY = -1;\n    }\n  };\n  onMounted(function () {\n    var _props$popupContentRe;\n    (_props$popupContentRe = props.popupContentRef.value) === null || _props$popupContentRe === void 0 || _props$popupContentRe.addEventListener(\"scroll\", onInnerVirtualScroll);\n  });\n  onBeforeUnmount(function () {\n    var _props$popupContentRe2;\n    (_props$popupContentRe2 = props.popupContentRef.value) === null || _props$popupContentRe2 === void 0 || _props$popupContentRe2.removeEventListener(\"scroll\", onInnerVirtualScroll);\n  });\n  var cursorStyle = computed(function () {\n    return {\n      position: \"absolute\",\n      width: \"1px\",\n      height: \"1px\",\n      transition: \"transform 0.2s\",\n      transform: \"translate(0, \".concat(scrollHeight.value, \"px)\"),\n      \"-ms-transform\": \"translate(0, \".concat(scrollHeight.value, \"px)\"),\n      \"-moz-transform\": \"translate(0, \".concat(scrollHeight.value, \"px)\"),\n      \"-webkit-transform\": \"translate(0, \".concat(scrollHeight.value, \"px)\")\n    };\n  });\n  var panelStyle = computed(function () {\n    return {\n      transform: \"translate(0, \".concat(translateY.value, \"px)\"),\n      \"-ms-transform\": \"translate(0, \".concat(translateY.value, \"px)\"),\n      \"-moz-transform\": \"translate(0, \".concat(translateY.value, \"px)\"),\n      \"-webkit-transform\": \"translate(0, \".concat(translateY.value, \"px)\")\n    };\n  });\n  return {\n    trs: trs,\n    scrollHeight: scrollHeight,\n    translateY: translateY,\n    visibleData: visibleData,\n    handleRowMounted: handleRowMounted,\n    isVirtual: isVirtual,\n    cursorStyle: cursorStyle,\n    panelStyle: panelStyle\n  };\n};\nexport { usePanelVirtualScroll };","map":{"version":3,"names":["usePanelVirtualScroll","props","_props$scroll3","_props$scroll4","_props$scroll5","_props$scroll6","_props$scroll7","isVirtual","computed","_props$scroll","_props$options$value","_props$scroll2","scroll","type","options","value","length","threshold","_ref","useVirtualScroll","container","popupContentRef","data","fixedHeight","isFixedRowHeight","lineHeight","rowHeight","bufferSize","_ref$trs","trs","_ref$visibleData","visibleData","_ref$handleScroll","handleScroll","handleVirtualScroll","_ref$scrollHeight","scrollHeight","_ref$translateY","translateY","_ref$handleRowMounted","handleRowMounted","lastScrollY","onInnerVirtualScroll","e","target","top","scrollTop","Math","abs","onMounted","_props$popupContentRe","addEventListener","onBeforeUnmount","_props$popupContentRe2","removeEventListener","cursorStyle","position","width","height","transition","transform","concat","panelStyle"],"sources":["../../../src/select/hooks/usePanelVirtualScroll.ts"],"sourcesContent":["import { Ref, computed, onMounted, onBeforeUnmount } from 'vue';\nimport useVirtualScroll from '../../hooks/useVirtualScroll';\nimport { TdSelectProps } from '../type';\nimport { Styles } from '../../common';\n\nexport const usePanelVirtualScroll = (props: {\n  scroll: TdSelectProps['scroll'];\n  popupContentRef: Ref<HTMLElement>;\n  options: Ref<TdSelectProps['options']>;\n}) => {\n  const isVirtual = computed(\n    () => props.scroll?.type === 'virtual' && props.options.value?.length > (props.scroll?.threshold || 100),\n  );\n\n  const {\n    trs = null,\n    visibleData = null,\n    handleScroll: handleVirtualScroll = null,\n    scrollHeight = null,\n    translateY = null,\n    handleRowMounted = null,\n  } = props.scroll?.type === 'virtual'\n    ? useVirtualScroll({\n        container: props.popupContentRef,\n        data: props.options,\n        fixedHeight: props.scroll?.isFixedRowHeight || false,\n        lineHeight: props.scroll?.rowHeight || 28, // 默认每行高度28\n        bufferSize: props.scroll?.bufferSize || 20,\n        threshold: props.scroll?.threshold || 100,\n      })\n    : {};\n  let lastScrollY = -1;\n\n  const onInnerVirtualScroll = (e: WheelEvent) => {\n    if (!isVirtual.value) {\n      return;\n    }\n    const target = e.target as HTMLElement;\n    const top = target.scrollTop;\n    // 排除横向滚动触发的纵向虚拟滚动计算\n    if (Math.abs(lastScrollY - top) > 5) {\n      handleVirtualScroll();\n      lastScrollY = top;\n    } else {\n      lastScrollY = -1;\n    }\n  };\n\n  // 监听popup滚动 处理虚拟滚动时的virtualData变化\n  onMounted(() => {\n    props.popupContentRef.value?.addEventListener('scroll', onInnerVirtualScroll);\n  });\n\n  // 卸载时取消监听\n  onBeforeUnmount(() => {\n    props.popupContentRef.value?.removeEventListener('scroll', onInnerVirtualScroll);\n  });\n\n  const cursorStyle = computed(\n    () =>\n      ({\n        position: 'absolute',\n        width: '1px',\n        height: '1px',\n        transition: 'transform 0.2s',\n        transform: `translate(0, ${scrollHeight.value}px)`,\n        '-ms-transform': `translate(0, ${scrollHeight.value}px)`,\n        '-moz-transform': `translate(0, ${scrollHeight.value}px)`,\n        '-webkit-transform': `translate(0, ${scrollHeight.value}px)`,\n      } as Styles),\n  );\n\n  const panelStyle = computed(\n    () =>\n      ({\n        transform: `translate(0, ${translateY.value}px)`,\n        '-ms-transform': `translate(0, ${translateY.value}px)`,\n        '-moz-transform': `translate(0, ${translateY.value}px)`,\n        '-webkit-transform': `translate(0, ${translateY.value}px)`,\n      } as Styles),\n  );\n\n  return {\n    trs,\n    scrollHeight,\n    translateY,\n    visibleData,\n    handleRowMounted,\n    isVirtual,\n    cursorStyle,\n    panelStyle,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}