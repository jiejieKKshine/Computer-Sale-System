{"ast":null,"code":"/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { defineComponent, ref, shallowRef, reactive, computed, onMounted, watch, createVNode } from 'vue';\nimport props from './props.mjs';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url.mjs';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle.mjs';\nimport injectStyle from '../_common/js/utils/injectStyle.mjs';\nimport { usePrefixClass } from '../hooks/useConfig.mjs';\nimport { useMutationObserver } from './hooks.mjs';\nimport { useContent } from '../hooks/tnode.mjs';\nimport setStyle from '../_common/js/utils/set-style.mjs';\nimport '../_chunks/dep-fa52aa21.mjs';\nimport '../_chunks/dep-4659d73b.mjs';\nimport '../config-provider/useConfig.mjs';\nimport '../_chunks/dep-06dcbf4c.mjs';\nimport '../_chunks/dep-eca422c3.mjs';\nimport '../_chunks/dep-bf7257e7.mjs';\nimport '../_chunks/dep-2b09875b.mjs';\nimport '../_chunks/dep-cda4f568.mjs';\nimport '../_chunks/dep-bb899bfd.mjs';\nimport '../_chunks/dep-5922c8f3.mjs';\nimport '../_chunks/dep-92f86d1d.mjs';\nimport '../_chunks/dep-6ab5363f.mjs';\nimport '../_chunks/dep-6dc3d0e1.mjs';\nimport '../_chunks/dep-76958824.mjs';\nimport '../_chunks/dep-e9841b9e.mjs';\nimport '../_chunks/dep-1a4bb2f2.mjs';\nimport '../_chunks/dep-cc8ebcde.mjs';\nimport '../_chunks/dep-29ef8419.mjs';\nimport '../_chunks/dep-f5579c03.mjs';\nimport '../_chunks/dep-49aeee3c.mjs';\nimport '../_chunks/dep-b5bf85f5.mjs';\nimport '../_chunks/dep-3c65fae8.mjs';\nimport '../_chunks/dep-eae2a67e.mjs';\nimport '../_chunks/dep-626c497d.mjs';\nimport '../_chunks/dep-ec0bbd9f.mjs';\nimport '../_chunks/dep-1b78414a.mjs';\nimport '../_chunks/dep-d84f19b3.mjs';\nimport '../_chunks/dep-732f0b7d.mjs';\nimport '../_chunks/dep-03a7fb6c.mjs';\nimport '../_chunks/dep-1b9718a2.mjs';\nimport '../_chunks/dep-e065dc25.mjs';\nimport '../_chunks/dep-400ec705.mjs';\nimport '../_chunks/dep-02f9394e.mjs';\nimport '../_chunks/dep-1725b1c7.mjs';\nimport '../_chunks/dep-532409c5.mjs';\nimport '../_common/js/global-config/default-config.mjs';\nimport '../_common/js/global-config/locale/zh_CN.mjs';\nimport '../_chunks/dep-9ed7da3e.mjs';\nimport '../_chunks/dep-7f65fc46.mjs';\nimport '../_chunks/dep-4f2cabb0.mjs';\nimport '../config-provider/type.mjs';\nimport '../_chunks/dep-5d3f7c0e.mjs';\nimport '../_chunks/dep-03ad9cda.mjs';\nimport '../_chunks/dep-7932c2e8.mjs';\nimport '../_chunks/dep-ab4bb9b8.mjs';\nimport '../_chunks/dep-d8a34055.mjs';\nimport '../_chunks/dep-2f6e28a0.mjs';\nimport '../_chunks/dep-5a17bf21.mjs';\nimport '../_chunks/dep-bad871d5.mjs';\nimport '../utils/render-tnode.mjs';\nimport '../_chunks/dep-b91a8171.mjs';\nfunction _createForOfIteratorHelper(r, e) {\n  var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (!t) {\n    if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) {\n      t && (r = t);\n      var _n = 0,\n        F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          return _n >= r.length ? {\n            done: !0\n          } : {\n            done: !1,\n            value: r[_n++]\n          };\n        },\n        e: function e(r) {\n          throw r;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var o,\n    a = !0,\n    u = !1;\n  return {\n    s: function s() {\n      t = t.call(r);\n    },\n    n: function n() {\n      var r = t.next();\n      return a = r.done, r;\n    },\n    e: function e(r) {\n      u = !0, o = r;\n    },\n    f: function f() {\n      try {\n        a || null == t[\"return\"] || t[\"return\"]();\n      } finally {\n        if (u) throw o;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nvar _Watermark = defineComponent({\n  name: \"TWatermark\",\n  props: props,\n  setup: function setup(props2) {\n    var backgroundImage = ref(\"\");\n    var watermarkRef = shallowRef();\n    var watermarkContentRef = shallowRef();\n    var offset = reactive(props2.offset || []);\n    var gapX = computed(function () {\n      return props2.movable ? 0 : props2.x;\n    });\n    var gapY = computed(function () {\n      return props2.movable ? 0 : props2.y;\n    });\n    var rotate = computed(function () {\n      return props2.movable ? 0 : props2.rotate;\n    });\n    var backgroundRepeat = computed(function () {\n      if (props2.movable) {\n        return \"no-repeat\";\n      }\n      return props2.isRepeat ? \"repeat\" : \"no-repeat\";\n    });\n    var offsetLeft = computed(function () {\n      return offset[0] || gapX.value / 2;\n    });\n    var offsetTop = computed(function () {\n      return offset[1] || gapY.value / 2;\n    });\n    var bgImageOptions = computed(function () {\n      return {\n        width: props2.width,\n        height: props2.height,\n        rotate: rotate.value,\n        lineSpace: props2.lineSpace,\n        alpha: props2.alpha,\n        gapX: gapX.value,\n        gapY: gapY.value,\n        watermarkContent: props2.watermarkContent,\n        offsetLeft: offsetLeft.value,\n        offsetTop: offsetTop.value\n      };\n    });\n    var removeWaterMark = function removeWaterMark() {\n      if (!watermarkContentRef.value) return;\n      watermarkContentRef.value.remove();\n      watermarkContentRef.value = null;\n    };\n    var injectWaterMark = function injectWaterMark() {\n      generateBase64Url(bgImageOptions.value, function (base64Url) {\n        var _watermarkRef$value;\n        removeWaterMark();\n        backgroundImage.value = base64Url;\n        watermarkContentRef.value = document.createElement(\"div\");\n        setStyle(watermarkContentRef.value, {\n          zIndex: props2.zIndex,\n          position: \"absolute\",\n          left: 0,\n          right: 0,\n          top: 0,\n          bottom: 0,\n          width: \"100%\",\n          height: \"100%\",\n          backgroundSize: \"\".concat(gapX.value + props2.width, \"px\"),\n          pointerEvents: \"none\",\n          backgroundRepeat: backgroundRepeat.value,\n          backgroundImage: \"url('\".concat(backgroundImage.value, \"')\"),\n          animation: props2.movable ? \"watermark infinite \".concat(props2.moveInterval * 4 / 60, \"s\") : \"none\"\n        });\n        (_watermarkRef$value = watermarkRef.value) === null || _watermarkRef$value === void 0 || _watermarkRef$value.append(watermarkContentRef.value);\n      });\n      if (props2.movable) {\n        var keyframesStyle = randomMovingStyle();\n        injectStyle(keyframesStyle);\n      }\n    };\n    onMounted(function () {\n      injectWaterMark();\n      useMutationObserver(watermarkRef.value, function (mutations) {\n        if (props2.removable || !watermarkContentRef.value) return;\n        var _iterator = _createForOfIteratorHelper(mutations),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var mutation = _step.value;\n            var isRemoved = Array.from(mutation.removedNodes).includes(watermarkContentRef.value);\n            var isModified = mutation.type === \"attributes\" && watermarkContentRef.value === mutation.target;\n            if (isRemoved || isModified) {\n              injectWaterMark();\n              break;\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      }, {\n        attributes: true,\n        childList: true,\n        characterData: true,\n        subtree: true\n      });\n    });\n    watch(function () {\n      return props2;\n    }, injectWaterMark, {\n      deep: true,\n      flush: \"post\"\n    });\n    return {\n      gapX: gapX,\n      gapY: gapY,\n      backgroundRepeat: backgroundRepeat,\n      backgroundImage: backgroundImage,\n      watermarkRef: watermarkRef,\n      watermarkContentRef: watermarkContentRef,\n      bgImageOptions: bgImageOptions\n    };\n  },\n  render: function render() {\n    var COMPONENT_NAME = usePrefixClass(\"watermark\");\n    var renderContent = useContent();\n    return createVNode(\"div\", {\n      \"style\": {\n        position: \"relative\",\n        overflow: \"hidden\",\n        width: \"100%\"\n      },\n      \"class\": COMPONENT_NAME.value,\n      \"ref\": \"watermarkRef\"\n    }, [renderContent(\"default\", \"content\")]);\n  }\n});\nexport { _Watermark as default };","map":{"version":3,"names":["_Watermark","defineComponent","name","props","setup","props2","backgroundImage","ref","watermarkRef","shallowRef","watermarkContentRef","offset","reactive","gapX","computed","movable","x","gapY","y","rotate","backgroundRepeat","isRepeat","offsetLeft","value","offsetTop","bgImageOptions","width","height","lineSpace","alpha","watermarkContent","removeWaterMark","remove","injectWaterMark","generateBase64Url","base64Url","_watermarkRef$value","document","createElement","setStyle","zIndex","position","left","right","top","bottom","backgroundSize","concat","pointerEvents","animation","moveInterval","append","keyframesStyle","randomMovingStyle","injectStyle","onMounted","useMutationObserver","mutations","removable","_iterator","_createForOfIteratorHelper","_step","s","n","done","mutation","isRemoved","Array","from","removedNodes","includes","isModified","type","target","err","e","f","attributes","childList","characterData","subtree","watch","deep","flush","render","COMPONENT_NAME","usePrefixClass","renderContent","useContent","createVNode","overflow"],"sources":["../../src/watermark/watermark.tsx"],"sourcesContent":["import { computed, onMounted, defineComponent, watch, ref, reactive, shallowRef } from 'vue';\nimport props from './props';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle';\nimport injectStyle from '../_common/js/utils/injectStyle';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useMutationObserver } from './hooks';\nimport { useContent } from '../hooks/tnode';\nimport setStyle from '../_common/js/utils/set-style';\n\nexport default defineComponent({\n  name: 'TWatermark',\n  props,\n  setup(props) {\n    const backgroundImage = ref('');\n    const watermarkRef = shallowRef<HTMLElement>();\n    const watermarkContentRef = shallowRef<HTMLElement>();\n\n    const offset = reactive(props.offset || []);\n\n    const gapX = computed(() => {\n      return props.movable ? 0 : props.x;\n    });\n\n    const gapY = computed(() => {\n      return props.movable ? 0 : props.y;\n    });\n\n    const rotate = computed(() => {\n      return props.movable ? 0 : props.rotate;\n    });\n\n    const backgroundRepeat = computed(() => {\n      if (props.movable) {\n        return 'no-repeat';\n      }\n      return props.isRepeat ? 'repeat' : 'no-repeat';\n    });\n\n    const offsetLeft = computed(() => {\n      return offset[0] || gapX.value / 2;\n    });\n\n    const offsetTop = computed(() => {\n      return offset[1] || gapY.value / 2;\n    });\n\n    const bgImageOptions = computed(() => ({\n      width: props.width,\n      height: props.height,\n      rotate: rotate.value,\n      lineSpace: props.lineSpace,\n      alpha: props.alpha,\n      gapX: gapX.value,\n      gapY: gapY.value,\n      watermarkContent: props.watermarkContent,\n      offsetLeft: offsetLeft.value,\n      offsetTop: offsetTop.value,\n    }));\n\n    const removeWaterMark = () => {\n      if (!watermarkContentRef.value) return;\n      watermarkContentRef.value.remove();\n      watermarkContentRef.value = null;\n    };\n\n    const injectWaterMark = () => {\n      generateBase64Url(bgImageOptions.value, (base64Url) => {\n        removeWaterMark();\n\n        backgroundImage.value = base64Url;\n        watermarkContentRef.value = document.createElement('div');\n        setStyle(watermarkContentRef.value, {\n          zIndex: props.zIndex,\n          position: 'absolute',\n          left: 0,\n          right: 0,\n          top: 0,\n          bottom: 0,\n          width: '100%',\n          height: '100%',\n          backgroundSize: `${gapX.value + props.width}px`,\n          pointerEvents: 'none',\n          backgroundRepeat: backgroundRepeat.value,\n          backgroundImage: `url('${backgroundImage.value}')`,\n          animation: props.movable ? `watermark infinite ${(props.moveInterval * 4) / 60}s` : 'none',\n        });\n        watermarkRef.value?.append(watermarkContentRef.value);\n      });\n\n      if (props.movable) {\n        const keyframesStyle = randomMovingStyle();\n        injectStyle(keyframesStyle);\n      }\n    };\n\n    onMounted(() => {\n      injectWaterMark();\n      useMutationObserver(\n        watermarkRef.value,\n        (mutations) => {\n          if (props.removable || !watermarkContentRef.value) return;\n          for (const mutation of mutations) {\n            const isRemoved = Array.from(mutation.removedNodes).includes(watermarkContentRef.value);\n            const isModified = mutation.type === 'attributes' && watermarkContentRef.value === mutation.target;\n            if (isRemoved || isModified) {\n              injectWaterMark();\n              break;\n            }\n          }\n        },\n        {\n          attributes: true,\n          childList: true,\n          characterData: true,\n          subtree: true,\n        },\n      );\n    });\n\n    watch(() => props, injectWaterMark, { deep: true, flush: 'post' });\n\n    return {\n      gapX,\n      gapY,\n      backgroundRepeat,\n      backgroundImage,\n      watermarkRef,\n      watermarkContentRef,\n      bgImageOptions,\n    };\n  },\n\n  render() {\n    const COMPONENT_NAME = usePrefixClass('watermark');\n    const renderContent = useContent();\n\n    return (\n      <div\n        style={{ position: 'relative', overflow: 'hidden', width: '100%' }}\n        class={COMPONENT_NAME.value}\n        ref=\"watermarkRef\"\n      >\n        {renderContent('default', 'content')}\n      </div>\n    );\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}