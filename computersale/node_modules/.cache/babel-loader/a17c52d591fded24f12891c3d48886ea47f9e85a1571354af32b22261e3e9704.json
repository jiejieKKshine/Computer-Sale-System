{"ast":null,"code":"/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { toRefs, ref, computed } from 'vue';\nimport { g as get_1 } from '../../_chunks/dep-ae202bc0.mjs';\nimport { on, off } from '../../utils/dom.mjs';\nimport { ARROW_DOWN_REG, ARROW_UP_REG, SPACE_REG, ESCAPE_REG, ALL_REG, CLEAR_REG } from '../../_common/js/common.mjs';\nimport '../../_chunks/dep-eca422c3.mjs';\nimport '../../_chunks/dep-aeaef131.mjs';\nimport '../../_chunks/dep-eae2a67e.mjs';\nimport '../../_chunks/dep-626c497d.mjs';\nimport '../../_chunks/dep-4659d73b.mjs';\nimport '../../_chunks/dep-ab4bb9b8.mjs';\nimport '../../_chunks/dep-bf7257e7.mjs';\nimport '../../_chunks/dep-29ef8419.mjs';\nimport '../../_chunks/dep-6ab5363f.mjs';\nimport '../../_chunks/dep-6dc3d0e1.mjs';\nimport '../../_chunks/dep-06dcbf4c.mjs';\nimport '../../_chunks/dep-2b09875b.mjs';\nimport '../../_chunks/dep-cda4f568.mjs';\nimport '../../_chunks/dep-76958824.mjs';\nimport '../../_chunks/dep-e9841b9e.mjs';\nimport '../../_chunks/dep-7932c2e8.mjs';\nimport '../../_chunks/dep-03a7fb6c.mjs';\nimport '../../utils/easing.mjs';\nfunction useHoverKeyboardEvent(props, tableRef) {\n  var _toRefs = toRefs(props),\n    hover = _toRefs.hover,\n    data = _toRefs.data,\n    activeRowType = _toRefs.activeRowType,\n    keyboardRowHover = _toRefs.keyboardRowHover,\n    disableSpaceInactiveRow = _toRefs.disableSpaceInactiveRow;\n  var hoverRow = ref();\n  var currentHoverRowIndex = ref(-1);\n  var needKeyboardRowHover = computed(function () {\n    if (activeRowType.value === \"single\") return false;\n    if (activeRowType.value === \"multiple\") return true;\n    return hover.value || keyboardRowHover.value;\n  });\n  var onHoverRow = function onHoverRow(ctx, extra) {\n    var rowValue = get_1(ctx.row, props.rowKey);\n    if (hoverRow.value === rowValue && (extra === null || extra === void 0 ? void 0 : extra.action) !== \"hover\") {\n      if (!disableSpaceInactiveRow.value) {\n        hoverRow.value = void 0;\n      }\n    } else {\n      hoverRow.value = rowValue;\n    }\n    currentHoverRowIndex.value = ctx.index;\n  };\n  var clearHoverRow = function clearHoverRow() {\n    hoverRow.value = void 0;\n    currentHoverRowIndex.value = -1;\n  };\n  var keyboardDownListener = function keyboardDownListener(e) {\n    var _e$key;\n    if (!needKeyboardRowHover.value) return;\n    var code = e.code || ((_e$key = e.key) === null || _e$key === void 0 ? void 0 : _e$key.trim());\n    if (ARROW_DOWN_REG.test(code)) {\n      e.preventDefault();\n      var index = Math.min(data.value.length - 1, currentHoverRowIndex.value + 1);\n      onHoverRow({\n        row: data.value[index],\n        index: index,\n        e: e\n      }, {\n        action: \"hover\"\n      });\n    } else if (ARROW_UP_REG.test(code)) {\n      e.preventDefault();\n      var _index = Math.max(0, currentHoverRowIndex.value - 1);\n      onHoverRow({\n        row: data.value[_index],\n        index: _index,\n        e: e\n      }, {\n        action: \"hover\"\n      });\n    } else if (SPACE_REG.test(code) && props.activeRowType !== \"multiple\") {\n      var _index2 = currentHoverRowIndex.value;\n      onHoverRow({\n        row: data.value[_index2],\n        index: _index2,\n        e: e\n      });\n      if (!props.activeRowType) {\n        var _props$onActiveRowAct;\n        (_props$onActiveRowAct = props.onActiveRowAction) === null || _props$onActiveRowAct === void 0 || _props$onActiveRowAct.call(props, {\n          action: \"space-one-selection\",\n          activeRowList: [{\n            row: data.value[_index2],\n            rowIndex: _index2\n          }]\n        });\n      }\n    } else if (ESCAPE_REG.test(code) && !props.activeRowType) {\n      var _props$onActiveRowAct2;\n      hoverRow.value = void 0;\n      (_props$onActiveRowAct2 = props.onActiveRowAction) === null || _props$onActiveRowAct2 === void 0 || _props$onActiveRowAct2.call(props, {\n        action: \"clear\",\n        activeRowList: []\n      });\n    } else if (ALL_REG.test(code) && !props.activeRowType) {\n      var _props$onActiveRowAct3;\n      (_props$onActiveRowAct3 = props.onActiveRowAction) === null || _props$onActiveRowAct3 === void 0 || _props$onActiveRowAct3.call(props, {\n        action: \"select-all\",\n        activeRowList: []\n      });\n    } else if (CLEAR_REG.test(code) && !props.activeRowType) {\n      var _props$onActiveRowAct4;\n      (_props$onActiveRowAct4 = props.onActiveRowAction) === null || _props$onActiveRowAct4 === void 0 || _props$onActiveRowAct4.call(props, {\n        action: \"clear\",\n        activeRowList: []\n      });\n    }\n  };\n  var addRowHoverKeyboardListener = function addRowHoverKeyboardListener() {\n    on(tableRef.value, \"keydown\", keyboardDownListener);\n  };\n  var removeRowHoverKeyboardListener = function removeRowHoverKeyboardListener() {\n    off(tableRef.value, \"keydown\", keyboardDownListener);\n  };\n  return {\n    hoverRow: hoverRow,\n    needKeyboardRowHover: needKeyboardRowHover,\n    clearHoverRow: clearHoverRow,\n    addRowHoverKeyboardListener: addRowHoverKeyboardListener,\n    removeRowHoverKeyboardListener: removeRowHoverKeyboardListener\n  };\n}\nexport { useHoverKeyboardEvent as default, useHoverKeyboardEvent };","map":{"version":3,"names":["useHoverKeyboardEvent","props","tableRef","_toRefs","toRefs","hover","data","activeRowType","keyboardRowHover","disableSpaceInactiveRow","hoverRow","ref","currentHoverRowIndex","needKeyboardRowHover","computed","value","onHoverRow","ctx","extra","rowValue","get_1","row","rowKey","action","index","clearHoverRow","keyboardDownListener","e","_e$key","code","key","trim","ARROW_DOWN_REG","test","preventDefault","Math","min","length","ARROW_UP_REG","_index","max","SPACE_REG","_index2","_props$onActiveRowAct","onActiveRowAction","call","activeRowList","rowIndex","ESCAPE_REG","_props$onActiveRowAct2","ALL_REG","_props$onActiveRowAct3","CLEAR_REG","_props$onActiveRowAct4","addRowHoverKeyboardListener","on","removeRowHoverKeyboardListener","off"],"sources":["../../../src/table/hooks/useHoverKeyboardEvent.ts"],"sourcesContent":["import { toRefs, Ref, ref, computed } from 'vue';\nimport get from 'lodash/get';\nimport { BaseTableProps } from '../interface';\nimport { on, off } from '../../utils/dom';\nimport { ALL_REG, ARROW_DOWN_REG, ARROW_UP_REG, CLEAR_REG, ESCAPE_REG, SPACE_REG } from '../../_common/js/common';\nimport { RowEventContext, TableRowData } from '../type';\n\n/**\n * 需要进行表格行操作时，则需要键盘操作的悬浮效果来表达当前的哪一行\n * 如：高亮多行、行选中、行展开等功能\n */\nexport function useHoverKeyboardEvent(props: BaseTableProps, tableRef: Ref<HTMLDivElement>) {\n  const { hover, data, activeRowType, keyboardRowHover, disableSpaceInactiveRow } = toRefs(props);\n  const hoverRow = ref<string | number>();\n  const currentHoverRowIndex = ref(-1);\n\n  // 单行高亮场景，不需要键盘悬浮效果\n  const needKeyboardRowHover = computed(() => {\n    if (activeRowType.value === 'single') return false;\n    if (activeRowType.value === 'multiple') return true;\n    return hover.value || keyboardRowHover.value;\n  });\n\n  const onHoverRow = (ctx: RowEventContext<TableRowData>, extra?: { action?: 'hover' }) => {\n    const rowValue = get(ctx.row, props.rowKey);\n    if (hoverRow.value === rowValue && extra?.action !== 'hover') {\n      if (!disableSpaceInactiveRow.value) {\n        hoverRow.value = undefined;\n      }\n    } else {\n      hoverRow.value = rowValue;\n    }\n    currentHoverRowIndex.value = ctx.index;\n  };\n\n  const clearHoverRow = () => {\n    hoverRow.value = undefined;\n    currentHoverRowIndex.value = -1;\n  };\n\n  const keyboardDownListener = (e: KeyboardEvent) => {\n    if (!needKeyboardRowHover.value) return;\n    const code = e.code || e.key?.trim();\n    if (ARROW_DOWN_REG.test(code)) {\n      e.preventDefault();\n      const index = Math.min(data.value.length - 1, currentHoverRowIndex.value + 1);\n      onHoverRow({ row: data.value[index], index, e }, { action: 'hover' });\n    } else if (ARROW_UP_REG.test(code)) {\n      e.preventDefault();\n      const index = Math.max(0, currentHoverRowIndex.value - 1);\n      onHoverRow({ row: data.value[index], index, e }, { action: 'hover' });\n    } else if (SPACE_REG.test(code) && props.activeRowType !== 'multiple') {\n      const index = currentHoverRowIndex.value;\n      onHoverRow({ row: data.value[index], index, e });\n\n      if (!props.activeRowType) {\n        props.onActiveRowAction?.({\n          action: 'space-one-selection',\n          activeRowList: [{ row: data.value[index], rowIndex: index }],\n        });\n      }\n    } else if (ESCAPE_REG.test(code) && !props.activeRowType) {\n      hoverRow.value = undefined;\n      props.onActiveRowAction?.({ action: 'clear', activeRowList: [] });\n    } else if (ALL_REG.test(code) && !props.activeRowType) {\n      props.onActiveRowAction?.({ action: 'select-all', activeRowList: [] });\n    } else if (CLEAR_REG.test(code) && !props.activeRowType) {\n      props.onActiveRowAction?.({ action: 'clear', activeRowList: [] });\n    }\n  };\n\n  const addRowHoverKeyboardListener = () => {\n    on(tableRef.value, 'keydown', keyboardDownListener);\n  };\n\n  const removeRowHoverKeyboardListener = () => {\n    off(tableRef.value, 'keydown', keyboardDownListener);\n  };\n\n  return {\n    hoverRow,\n    needKeyboardRowHover,\n    clearHoverRow,\n    addRowHoverKeyboardListener,\n    removeRowHoverKeyboardListener,\n  };\n}\n\nexport default useHoverKeyboardEvent;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}