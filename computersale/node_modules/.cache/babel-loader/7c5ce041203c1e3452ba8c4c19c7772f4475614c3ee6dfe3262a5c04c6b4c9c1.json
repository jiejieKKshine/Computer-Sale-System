{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\n/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _slicedToArray } from '../_chunks/dep-5efe53d1.mjs';\nimport { _ as _toConsumableArray } from '../_chunks/dep-4a990ea3.mjs';\nimport { isVNode, Fragment, Comment, Text, getCurrentInstance, ref, onMounted, onUpdated, defineComponent, watch, createVNode, Teleport } from 'vue';\nimport popupProps from './props.mjs';\nimport useResizeObserver from '../hooks/useResizeObserver.mjs';\nimport { i as isArray_1 } from '../_chunks/dep-eae2a67e.mjs';\nimport { getSSRAttach, getAttach } from '../utils/dom.mjs';\nimport '../_chunks/dep-593f2b67.mjs';\nimport '../_chunks/dep-eca422c3.mjs';\nimport '../_chunks/dep-03a7fb6c.mjs';\nimport '../_chunks/dep-bf7257e7.mjs';\nimport '../_chunks/dep-4659d73b.mjs';\nimport '../_chunks/dep-626c497d.mjs';\nimport '../_chunks/dep-29ef8419.mjs';\nimport '../_chunks/dep-06dcbf4c.mjs';\nimport '../_chunks/dep-2b09875b.mjs';\nimport '../_chunks/dep-cda4f568.mjs';\nimport '../utils/easing.mjs';\nfunction _isSlot(s) {\n  return typeof s === 'function' || Object.prototype.toString.call(s) === '[object Object]' && !isVNode(s);\n}\nfunction filterEmpty() {\n  var children = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var vnodes = [];\n  children.forEach(function (child) {\n    if (isArray_1(child)) {\n      vnodes.push.apply(vnodes, _toConsumableArray(child));\n    } else if (child.type === Fragment) {\n      vnodes.push.apply(vnodes, _toConsumableArray(filterEmpty(child.children)));\n    } else {\n      vnodes.push(child);\n    }\n  });\n  return vnodes.filter(function (c) {\n    return !(c && (c.type === Comment || c.type === Fragment && c.children.length === 0 || c.type === Text && c.children.trim() === \"\"));\n  });\n}\nfunction isRectChanged(rect1, rect2) {\n  if (!rect1 && !rect2) return false;\n  if (!rect1 || !rect2) return true;\n  if ([\"width\", \"height\", \"x\", \"y\"].some(function (k) {\n    return rect1[k] !== rect2[k];\n  })) {\n    return true;\n  }\n  return false;\n}\nfunction useElement(getter) {\n  var instance = getCurrentInstance();\n  var el = ref();\n  onMounted(function () {\n    el.value = getter(instance);\n  });\n  onUpdated(function () {\n    var newEl = getter(instance);\n    if (el.value !== newEl) {\n      el.value = newEl;\n    }\n  });\n  return el;\n}\nvar Trigger = defineComponent({\n  name: \"TPopupTrigger\",\n  props: {\n    forwardRef: Function\n  },\n  emits: [\"resize\"],\n  setup: function setup(props2, _ref) {\n    var emit = _ref.emit,\n      slots = _ref.slots;\n    var el = useElement(function (vm) {\n      var containerNode = vm.parent.vnode;\n      return containerNode.el.nextElementSibling;\n    });\n    var contentRect = ref();\n    watch(el, function () {\n      var _props2$forwardRef;\n      (_props2$forwardRef = props2.forwardRef) === null || _props2$forwardRef === void 0 || _props2$forwardRef.call(props2, el.value);\n    });\n    useResizeObserver(el, function (_ref2) {\n      var _ref3 = _slicedToArray(_ref2, 1),\n        newContentRect = _ref3[0].contentRect;\n      contentRect.value = newContentRect;\n    });\n    watch(contentRect, function (newRect, oldRect) {\n      if (isRectChanged(newRect, oldRect)) {\n        emit(\"resize\");\n      }\n    });\n    return function () {\n      var _slots$default, _children$;\n      var children = filterEmpty((_slots$default = slots[\"default\"]) === null || _slots$default === void 0 ? void 0 : _slots$default.call(slots));\n      if (children.length > 1 || ((_children$ = children[0]) === null || _children$ === void 0 ? void 0 : _children$.type) === Text) {\n        return createVNode(\"span\", null, [children]);\n      }\n      return children[0];\n    };\n  }\n});\nvar Content = defineComponent({\n  name: \"TPopupContent\",\n  emits: [\"resize\"],\n  setup: function setup(props2, _ref4) {\n    var emit = _ref4.emit,\n      slots = _ref4.slots;\n    var contentEl = useElement(function (vm) {\n      return vm.vnode.el.children[0];\n    });\n    useResizeObserver(contentEl, function () {\n      emit(\"resize\");\n    });\n    return function () {\n      return createVNode(\"div\", {\n        \"style\": \"position: absolute; top: 0px; left: 0px; width: 100%\"\n      }, [slots[\"default\"]()]);\n    };\n  }\n});\nvar Container = defineComponent({\n  name: \"TPopupContainer\",\n  inheritAttrs: false,\n  props: {\n    parent: Object,\n    visible: Boolean,\n    attach: popupProps.attach,\n    forwardRef: Function\n  },\n  emits: [\"resize\", \"contentMounted\"],\n  setup: function setup(props2, _ref5) {\n    var emit = _ref5.emit,\n      attrs = _ref5.attrs,\n      slots = _ref5.slots,\n      expose = _ref5.expose;\n    var triggerEl = ref();\n    var mountContent = ref(false);\n    function emitResize() {\n      emit(\"resize\");\n    }\n    onMounted(function () {\n      requestAnimationFrame(function () {\n        mountContent.value = props2.visible;\n      });\n    });\n    watch(function () {\n      return props2.visible;\n    }, function (visible) {\n      if (visible) {\n        mountContent.value = props2.visible;\n      }\n    });\n    expose({\n      unmountContent: function unmountContent() {\n        mountContent.value = false;\n      }\n    });\n    return function () {\n      var _slot;\n      var getElement = function getElement() {\n        return getSSRAttach() || getAttach(props2.attach, triggerEl.value);\n      };\n      return createVNode(Fragment, null, [createVNode(Trigger, {\n        \"class\": attrs[\"class\"],\n        \"forwardRef\": function forwardRef(el) {\n          props2.forwardRef(el);\n          triggerEl.value = el;\n        },\n        \"onResize\": emitResize\n      }, _isSlot(_slot = slots[\"default\"]()) ? _slot : {\n        \"default\": function _default() {\n          return [_slot];\n        }\n      }), mountContent.value && createVNode(Teleport, {\n        \"disabled\": !getElement(),\n        \"to\": getElement()\n      }, {\n        \"default\": function _default() {\n          return [createVNode(Content, {\n            \"onResize\": emitResize,\n            \"onVnodeMounted\": function onVnodeMounted() {\n              return emit(\"contentMounted\");\n            }\n          }, {\n            \"default\": function _default() {\n              return [slots.content && slots.content()];\n            }\n          })];\n        }\n      })]);\n    };\n  }\n});\nexport { Container as default };","map":{"version":3,"names":["_isSlot","s","Object","prototype","toString","call","isVNode","filterEmpty","children","arguments","length","undefined","vnodes","forEach","child","isArray_1","push","apply","_toConsumableArray","type","Fragment","filter","c","Comment","Text","trim","isRectChanged","rect1","rect2","some","k","useElement","getter","instance","getCurrentInstance","el","ref","onMounted","value","onUpdated","newEl","Trigger","defineComponent","name","props","forwardRef","Function","emits","setup","props2","_ref","emit","slots","vm","containerNode","parent","vnode","nextElementSibling","contentRect","watch","_props2$forwardRef","useResizeObserver","_ref2","_ref3","_slicedToArray","newContentRect","newRect","oldRect","_slots$default","_children$","createVNode","Content","_ref4","contentEl","Container","inheritAttrs","visible","Boolean","attach","popupProps","_ref5","attrs","expose","triggerEl","mountContent","emitResize","requestAnimationFrame","unmountContent","_slot","getElement","getSSRAttach","getAttach","Teleport","_default","onVnodeMounted","content"],"sources":["../../src/popup/container.tsx"],"sourcesContent":["import {\n  defineComponent,\n  getCurrentInstance,\n  onMounted,\n  ref,\n  Fragment,\n  Text,\n  watch,\n  PropType,\n  VNode,\n  Teleport,\n  onUpdated,\n  ComponentInternalInstance,\n  Comment,\n} from 'vue';\nimport props from './props';\nimport useResizeObserver from '../hooks/useResizeObserver';\nimport isArray from 'lodash/isArray';\nimport { getSSRAttach, getAttach } from '../utils/dom';\n\nfunction filterEmpty(children: VNode[] = []) {\n  const vnodes: VNode[] = [];\n  children.forEach((child) => {\n    if (isArray(child)) {\n      vnodes.push(...child);\n    } else if (child.type === Fragment) {\n      vnodes.push(...filterEmpty(child.children as VNode[]));\n    } else {\n      vnodes.push(child);\n    }\n  });\n  return vnodes.filter(\n    (c) =>\n      !(\n        c &&\n        (c.type === Comment ||\n          (c.type === Fragment && c.children.length === 0) ||\n          (c.type === Text && (c.children as string).trim() === ''))\n      ),\n  );\n}\n\nfunction isRectChanged(rect1: DOMRectReadOnly, rect2: DOMRectReadOnly) {\n  if (!rect1 && !rect2) return false;\n  if (!rect1 || !rect2) return true;\n  if (['width', 'height', 'x', 'y'].some((k) => rect1[k] !== rect2[k])) {\n    return true;\n  }\n  return false;\n}\n\nfunction useElement<T = HTMLElement>(getter: (instance: ComponentInternalInstance) => T) {\n  const instance = getCurrentInstance();\n  const el = ref<T>();\n\n  onMounted(() => {\n    el.value = getter(instance);\n  });\n  onUpdated(() => {\n    const newEl = getter(instance);\n    if (el.value !== newEl) {\n      el.value = newEl;\n    }\n  });\n\n  return el;\n}\n\n// eslint-disable-next-line vue/one-component-per-file\nconst Trigger = defineComponent({\n  name: 'TPopupTrigger',\n  props: {\n    forwardRef: Function as PropType<(el: HTMLElement) => void>,\n  },\n  emits: ['resize'],\n  setup(props, { emit, slots }) {\n    const el = useElement((vm) => {\n      const containerNode = vm.parent.vnode;\n      // skip the first text node due to `Fragment`\n      return containerNode.el.nextElementSibling;\n    });\n    const contentRect = ref<DOMRectReadOnly>();\n\n    watch(el, () => {\n      props.forwardRef?.(el.value);\n    });\n\n    useResizeObserver(el, ([{ contentRect: newContentRect }]) => {\n      contentRect.value = newContentRect;\n    });\n\n    watch(contentRect, (newRect, oldRect) => {\n      if (isRectChanged(newRect, oldRect)) {\n        emit('resize');\n      }\n    });\n\n    return () => {\n      const children = filterEmpty(slots.default?.());\n      if (children.length > 1 || children[0]?.type === Text) {\n        return <span>{children}</span>;\n      }\n      return children[0];\n    };\n  },\n});\n\n// eslint-disable-next-line vue/one-component-per-file\nconst Content = defineComponent({\n  name: 'TPopupContent',\n  emits: ['resize'],\n  setup(props, { emit, slots }) {\n    const contentEl = useElement((vm) => vm.vnode.el.children[0]);\n    useResizeObserver(contentEl, () => {\n      emit('resize');\n    });\n\n    return () => {\n      return <div style=\"position: absolute; top: 0px; left: 0px; width: 100%\">{slots.default()}</div>;\n    };\n  },\n});\n\n// eslint-disable-next-line vue/one-component-per-file\nexport default defineComponent({\n  name: 'TPopupContainer',\n  inheritAttrs: false,\n  props: {\n    parent: Object,\n    visible: Boolean,\n    attach: props.attach,\n    forwardRef: Function as PropType<(el: HTMLElement) => void>,\n  },\n  emits: ['resize', 'contentMounted'],\n  setup(props, { emit, attrs, slots, expose }) {\n    const triggerEl = ref<HTMLElement>();\n    const mountContent = ref(false);\n\n    function emitResize() {\n      emit('resize');\n    }\n\n    onMounted(() => {\n      requestAnimationFrame(() => {\n        mountContent.value = props.visible;\n      });\n    });\n\n    watch(\n      () => props.visible,\n      (visible) => {\n        if (visible) {\n          mountContent.value = props.visible;\n        }\n      },\n    );\n\n    expose({\n      unmountContent() {\n        mountContent.value = false;\n      },\n    });\n\n    return () => {\n      const getElement = () => getSSRAttach() || getAttach(props.attach, triggerEl.value);\n      return (\n        <Fragment>\n          <Trigger\n            class={attrs.class}\n            forwardRef={(el: HTMLElement) => {\n              props.forwardRef(el);\n              triggerEl.value = el;\n            }}\n            onResize={emitResize}\n          >\n            {slots.default()}\n          </Trigger>\n          {mountContent.value && (\n            <Teleport disabled={!getElement()} to={getElement()}>\n              <Content onResize={emitResize} onVnodeMounted={() => emit('contentMounted')}>\n                {slots.content && slots.content()}\n              </Content>\n            </Teleport>\n          )}\n        </Fragment>\n      );\n    };\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}