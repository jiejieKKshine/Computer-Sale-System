{"ast":null,"code":"/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _slicedToArray } from '../../_chunks/dep-5efe53d1.mjs';\nimport { toRefs, computed, ref, watchEffect } from 'vue';\nimport useVModel from '../../hooks/useVModel.mjs';\nimport { i as isArray_1 } from '../../_chunks/dep-eae2a67e.mjs';\nimport { g as getDefaultFormat, h as extractTimeFormat, d as isValidDate, i as initYearMonthTime, f as formatDate, a as formatTime } from '../../_chunks/dep-421d1ae8.mjs';\nimport '../../_chunks/dep-593f2b67.mjs';\nimport '../../_chunks/dep-bad871d5.mjs';\nimport '../../_chunks/dep-eca422c3.mjs';\nimport '../../_chunks/dep-5a17bf21.mjs';\nimport '../../_chunks/dep-7932c2e8.mjs';\nimport '../../_chunks/dep-bf7257e7.mjs';\nimport '../../_chunks/dep-4659d73b.mjs';\nimport '../../_chunks/dep-626c497d.mjs';\nimport '../../_chunks/dep-ab4bb9b8.mjs';\nimport '../../_chunks/dep-29ef8419.mjs';\nimport '../../_chunks/dep-03a7fb6c.mjs';\nimport '../../_chunks/dep-7f65fc46.mjs';\nimport '../../_chunks/dep-fa52aa21.mjs';\nimport '../../_chunks/dep-06dcbf4c.mjs';\nimport '../../_chunks/dep-2b09875b.mjs';\nimport '../../_chunks/dep-cda4f568.mjs';\nimport '../../_chunks/dep-b36eaefe.mjs';\nimport '../../_chunks/dep-2f6e28a0.mjs';\nimport '../../_chunks/dep-532409c5.mjs';\nimport '../../_chunks/dep-e9841b9e.mjs';\nimport '../../_chunks/dep-cc8ebcde.mjs';\nimport '../../_chunks/dep-76958824.mjs';\nimport '../../_chunks/dep-ec0bbd9f.mjs';\nimport '../../_chunks/dep-7af61576.mjs';\nimport '../../_chunks/dep-8dfc9324.mjs';\nimport '../../_common/js/log/index.mjs';\nimport '../../_common/js/log/log.mjs';\nvar PARTIAL_MAP = {\n  first: \"start\",\n  second: \"end\"\n};\nfunction useRangeValue(props) {\n  var _toRefs = toRefs(props),\n    valueFromProps = _toRefs.value,\n    modelValue = _toRefs.modelValue;\n  var _useVModel = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange),\n    _useVModel2 = _slicedToArray(_useVModel, 2),\n    value = _useVModel2[0],\n    onChange = _useVModel2[1];\n  var formatRef = computed(function () {\n    return getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      valueType: props.valueType,\n      enableTimePicker: props.enableTimePicker\n    });\n  });\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format)) console.error(\"format: \".concat(formatRef.value.format, \" \\u4E0D\\u89C4\\u8303\\uFF0C\\u5305\\u542B\\u65F6\\u95F4\\u9009\\u62E9\\u5FC5\\u987B\\u8981\\u6709\\u65F6\\u95F4\\u683C\\u5F0F\\u5316 HH:mm:ss\"));\n  }\n  if (!isArray_1(value.value)) {\n    console.error(\"typeof value: \".concat(value.value, \" must be Array!\"));\n  } else if (!isValidDate(value.value, formatRef.value.format)) {\n    console.error(\"value: \".concat(value.value, \" is invalid dateTime! Check whether the value is consistent with format: \").concat(formatRef.value.format));\n  }\n  var isFirstValueSelected = ref(false);\n  var time = ref(initYearMonthTime({\n    value: value.value,\n    mode: props.mode,\n    format: formatRef.value.format,\n    timeFormat: formatRef.value.timeFormat\n  }).time);\n  var month = ref(initYearMonthTime({\n    value: value.value,\n    mode: props.mode,\n    format: formatRef.value.format,\n    enableTimePicker: props.enableTimePicker\n  }).month);\n  var year = ref(initYearMonthTime({\n    value: value.value,\n    mode: props.mode,\n    format: formatRef.value.format\n  }).year);\n  var cacheValue = ref(formatDate(value.value, {\n    format: formatRef.value.format\n  }));\n  watchEffect(function () {\n    if (!value.value) {\n      cacheValue.value = [];\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.valueType,\n      targetFormat: formatRef.value.format\n    });\n    time.value = formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime);\n  });\n  return {\n    year: year,\n    month: month,\n    value: value,\n    time: time,\n    isFirstValueSelected: isFirstValueSelected,\n    cacheValue: cacheValue,\n    onChange: onChange\n  };\n}\nexport { PARTIAL_MAP, useRangeValue as default };","map":{"version":3,"names":["PARTIAL_MAP","first","second","useRangeValue","props","_toRefs","toRefs","valueFromProps","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","formatRef","computed","getDefaultFormat","mode","format","valueType","enableTimePicker","extractTimeFormat","console","error","concat","isArray_1","isValidDate","isFirstValueSelected","ref","time","initYearMonthTime","timeFormat","month","year","cacheValue","formatDate","watchEffect","targetFormat","formatTime","defaultTime"],"sources":["../../../src/date-picker/hooks/useRangeValue.ts"],"sourcesContent":["import { ref, toRefs, watchEffect, computed } from 'vue';\nimport useVModel from '../../hooks/useVModel';\nimport isArray from 'lodash/isArray';\n\nimport { TdDateRangePickerProps } from '../type';\nimport {\n  isValidDate,\n  formatDate,\n  formatTime,\n  getDefaultFormat,\n  initYearMonthTime,\n} from '../../_common/js/date-picker/format';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport const PARTIAL_MAP = { first: 'start', second: 'end' };\n\nexport default function useRangeValue(props: TdDateRangePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      valueType: props.valueType,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  // warning invalid value\n  if (!isArray(value.value)) {\n    console.error(`typeof value: ${value.value} must be Array!`);\n  } else if (!isValidDate(value.value, formatRef.value.format)) {\n    console.error(\n      `value: ${value.value} is invalid dateTime! Check whether the value is consistent with format: ${formatRef.value.format}`,\n    );\n  }\n\n  const isFirstValueSelected = ref(false); // 记录面板点击次数，两次后才自动关闭\n  const time = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      timeFormat: formatRef.value.timeFormat,\n    }).time,\n  );\n  const month = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      enableTimePicker: props.enableTimePicker,\n    }).month,\n  );\n  const year = ref(initYearMonthTime({ value: value.value, mode: props.mode, format: formatRef.value.format }).year);\n  const cacheValue = ref(formatDate(value.value, { format: formatRef.value.format })); // 选择阶段预选状态\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = [];\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.valueType,\n      targetFormat: formatRef.value.format,\n    });\n    time.value = formatTime(\n      value.value,\n      formatRef.value.format,\n      formatRef.value.timeFormat,\n      props.defaultTime,\n    ) as string[];\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    isFirstValueSelected,\n    cacheValue,\n    onChange,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}