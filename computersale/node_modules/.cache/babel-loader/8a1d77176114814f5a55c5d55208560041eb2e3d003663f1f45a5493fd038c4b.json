{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\n/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _defineProperty } from '../_chunks/dep-fa52aa21.mjs';\nimport { _ as _typeof } from '../_chunks/dep-4659d73b.mjs';\nimport { toRefs, ref, computed } from 'vue';\nimport { i as isObject_1 } from '../_chunks/dep-2b09875b.mjs';\nimport { i as isFunction_1 } from '../_chunks/dep-06dcbf4c.mjs';\nimport { useDisabled } from '../hooks/useDisabled.mjs';\nimport { useReadonly } from '../hooks/useReadonly.mjs';\nimport '../_chunks/dep-eca422c3.mjs';\nimport '../_chunks/dep-bf7257e7.mjs';\nimport '../_chunks/dep-cda4f568.mjs';\nimport '../_chunks/dep-df472119.mjs';\nimport '../_chunks/dep-29ef8419.mjs';\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nvar MAX_POPUP_WIDTH = 1e3;\nvar RESERVE_WIDTH = 0;\nfunction useOverlayInnerStyle(props) {\n  var _toRefs = toRefs(props),\n    popupProps = _toRefs.popupProps,\n    autoWidth = _toRefs.autoWidth;\n  var innerPopupVisible = ref(false);\n  var disable = useDisabled();\n  var isReadonly = useReadonly();\n  var matchWidthFunc = function matchWidthFunc(triggerElement, popupElement) {\n    var SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? RESERVE_WIDTH : 0;\n    var width = popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth ? popupElement.offsetWidth : triggerElement.offsetWidth;\n    var otherOverlayInnerStyle = {};\n    if (popupProps.value && _typeof(popupProps.value.overlayInnerStyle) === \"object\" && !popupProps.value.overlayInnerStyle.width) {\n      otherOverlayInnerStyle = popupProps.value.overlayInnerStyle;\n    }\n    return _objectSpread({\n      width: \"\".concat(Math.min(width, MAX_POPUP_WIDTH), \"px\")\n    }, otherOverlayInnerStyle);\n  };\n  var onInnerPopupVisibleChange = function onInnerPopupVisibleChange(visible, ctx) {\n    if (disable.value || isReadonly.value) return;\n    var newVisible = ctx.trigger === \"trigger-element-click\" && props.allowInput ? true : visible;\n    if (props.popupVisible !== newVisible) {\n      var _props$onPopupVisible;\n      innerPopupVisible.value = newVisible;\n      (_props$onPopupVisible = props.onPopupVisibleChange) === null || _props$onPopupVisible === void 0 || _props$onPopupVisible.call(props, newVisible, ctx);\n    }\n  };\n  var getAutoWidthPopupStyleWidth = function getAutoWidthPopupStyleWidth(triggerElement, popupElement) {\n    var _popupProps$value;\n    return _objectSpread({\n      width: \"\".concat(Math.max(triggerElement.offsetWidth, popupElement.offsetWidth), \"px\")\n    }, (_popupProps$value = popupProps.value) === null || _popupProps$value === void 0 ? void 0 : _popupProps$value.overlayInnerStyle);\n  };\n  var tOverlayInnerStyle = computed(function () {\n    var _popupProps$value2;\n    var result = {};\n    var overlayInnerStyle = ((_popupProps$value2 = popupProps.value) === null || _popupProps$value2 === void 0 ? void 0 : _popupProps$value2.overlayInnerStyle) || {};\n    if (isFunction_1(overlayInnerStyle) || isObject_1(overlayInnerStyle) && overlayInnerStyle.width) {\n      result = overlayInnerStyle;\n    } else {\n      if (autoWidth.value) {\n        result = getAutoWidthPopupStyleWidth;\n      } else {\n        result = matchWidthFunc;\n      }\n    }\n    return result;\n  });\n  return {\n    tOverlayInnerStyle: tOverlayInnerStyle,\n    innerPopupVisible: innerPopupVisible,\n    onInnerPopupVisibleChange: onInnerPopupVisibleChange\n  };\n}\nexport { useOverlayInnerStyle as default };","map":{"version":3,"names":["MAX_POPUP_WIDTH","RESERVE_WIDTH","useOverlayInnerStyle","props","_toRefs","toRefs","popupProps","autoWidth","innerPopupVisible","ref","disable","useDisabled","isReadonly","useReadonly","matchWidthFunc","triggerElement","popupElement","SCROLLBAR_WIDTH","scrollHeight","offsetHeight","width","offsetWidth","otherOverlayInnerStyle","value","_typeof","overlayInnerStyle","_objectSpread","concat","Math","min","onInnerPopupVisibleChange","visible","ctx","newVisible","trigger","allowInput","popupVisible","_props$onPopupVisible","onPopupVisibleChange","call","getAutoWidthPopupStyleWidth","_popupProps$value","max","tOverlayInnerStyle","computed","_popupProps$value2","result","isFunction_1","isObject_1"],"sources":["../../src/select-input/useOverlayInnerStyle.ts"],"sourcesContent":["import { ref, toRefs, computed, CSSProperties } from 'vue';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { TdSelectInputProps } from './type';\nimport { TdPopupProps, PopupVisibleChangeContext } from '../popup';\nimport { useDisabled } from '../hooks/useDisabled';\nimport { useReadonly } from '../hooks/useReadonly';\n\nexport type overlayInnerStyleProps = Pick<\n  TdSelectInputProps,\n  'popupProps' | 'autoWidth' | 'readonly' | 'onPopupVisibleChange' | 'disabled' | 'allowInput' | 'popupVisible'\n>;\n\n// 单位：px\nconst MAX_POPUP_WIDTH = 1000;\n// 避免因滚动条出现文本省略，预留宽度 8\nconst RESERVE_WIDTH = 0;\n\nexport default function useOverlayInnerStyle(props: overlayInnerStyleProps) {\n  const { popupProps, autoWidth } = toRefs(props);\n  const innerPopupVisible = ref(false);\n  const disable = useDisabled();\n  const isReadonly = useReadonly();\n\n  const matchWidthFunc = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    const SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? RESERVE_WIDTH : 0;\n    const width =\n      popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth\n        ? popupElement.offsetWidth\n        : triggerElement.offsetWidth;\n    let otherOverlayInnerStyle: CSSProperties = {};\n    if (\n      popupProps.value &&\n      typeof popupProps.value.overlayInnerStyle === 'object' &&\n      !popupProps.value.overlayInnerStyle.width\n    ) {\n      otherOverlayInnerStyle = popupProps.value.overlayInnerStyle;\n    }\n    return {\n      width: `${Math.min(width, MAX_POPUP_WIDTH)}px`,\n      ...otherOverlayInnerStyle,\n    };\n  };\n\n  const onInnerPopupVisibleChange = (visible: boolean, ctx: PopupVisibleChangeContext) => {\n    if (disable.value || isReadonly.value) return;\n    // 如果点击触发元素（输入框）且为可输入状态，则继续显示下拉框\n    const newVisible = ctx.trigger === 'trigger-element-click' && props.allowInput ? true : visible;\n    // 重复点击触发元素时，下拉框展示状态不变，不重复触发事件\n    if (props.popupVisible !== newVisible) {\n      innerPopupVisible.value = newVisible;\n      props.onPopupVisibleChange?.(newVisible, ctx);\n    }\n  };\n\n  const getAutoWidthPopupStyleWidth = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    return {\n      width: `${Math.max(triggerElement.offsetWidth, popupElement.offsetWidth)}px`,\n      ...popupProps.value?.overlayInnerStyle,\n    };\n  };\n\n  const tOverlayInnerStyle = computed(() => {\n    let result: TdPopupProps['overlayInnerStyle'] = {};\n    const overlayInnerStyle = popupProps.value?.overlayInnerStyle || {};\n    if (isFunction(overlayInnerStyle) || (isObject(overlayInnerStyle) && overlayInnerStyle.width)) {\n      result = overlayInnerStyle;\n    } else {\n      if (autoWidth.value) {\n        result = getAutoWidthPopupStyleWidth;\n      } else {\n        result = matchWidthFunc;\n      }\n    }\n    return result;\n  });\n\n  return {\n    tOverlayInnerStyle,\n    innerPopupVisible,\n    onInnerPopupVisibleChange,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}