{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\n/**\n * tdesign v1.10.5\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _slicedToArray } from '../_chunks/dep-5efe53d1.mjs';\nimport { _ as _defineProperty } from '../_chunks/dep-fa52aa21.mjs';\nimport { isVNode, defineComponent, toRefs, ref, inject, provide, computed, watch, onUnmounted, nextTick, withDirectives, createVNode, mergeProps, vShow, Transition } from 'vue';\nimport { createPopper } from '@popperjs/core';\nimport { i as isFunction_1 } from '../_chunks/dep-06dcbf4c.mjs';\nimport { i as isObject_1 } from '../_chunks/dep-2b09875b.mjs';\nimport { d as debounce_1 } from '../_chunks/dep-5993931e.mjs';\nimport { i as isString_1 } from '../_chunks/dep-03a7fb6c.mjs';\nimport '../hooks/index.mjs';\nimport { usePrefixClass, useCommonClassName } from '../hooks/useConfig.mjs';\nimport useVModel from '../hooks/useVModel.mjs';\nimport { on, off, once } from '../utils/dom.mjs';\nimport setStyle from '../_common/js/utils/set-style.mjs';\nimport Container from './container.mjs';\nimport popupProps from './props.mjs';\nimport { useTNodeJSX, useContent } from '../hooks/tnode.mjs';\nimport '../_chunks/dep-593f2b67.mjs';\nimport '../_chunks/dep-4659d73b.mjs';\nimport '../_chunks/dep-eca422c3.mjs';\nimport '../_chunks/dep-bf7257e7.mjs';\nimport '../_chunks/dep-cda4f568.mjs';\nimport '../_chunks/dep-8dfc9324.mjs';\nimport '../_chunks/dep-ab4bb9b8.mjs';\nimport '../_chunks/dep-29ef8419.mjs';\nimport '../_chunks/dep-eae2a67e.mjs';\nimport '../_chunks/dep-626c497d.mjs';\nimport '../hooks/icon.mjs';\nimport '../hooks/slot.mjs';\nimport '../utils/render-tnode.mjs';\nimport '../_chunks/dep-b91a8171.mjs';\nimport '../_chunks/dep-1b78414a.mjs';\nimport '../_chunks/dep-1a4bb2f2.mjs';\nimport '../_chunks/dep-cc8ebcde.mjs';\nimport '../_chunks/dep-76958824.mjs';\nimport '../_chunks/dep-f5579c03.mjs';\nimport '../_chunks/dep-6dc3d0e1.mjs';\nimport '../_chunks/dep-d84f19b3.mjs';\nimport '../_chunks/dep-3c65fae8.mjs';\nimport '../_chunks/dep-03ad9cda.mjs';\nimport '../_chunks/dep-7932c2e8.mjs';\nimport '../_chunks/dep-d8a34055.mjs';\nimport '../_chunks/dep-2f6e28a0.mjs';\nimport '../_chunks/dep-5a17bf21.mjs';\nimport '../_chunks/dep-bad871d5.mjs';\nimport '../hooks/useCommonClassName.mjs';\nimport '../config-provider/useConfig.mjs';\nimport '../_chunks/dep-bb899bfd.mjs';\nimport '../_chunks/dep-5922c8f3.mjs';\nimport '../_chunks/dep-92f86d1d.mjs';\nimport '../_chunks/dep-6ab5363f.mjs';\nimport '../_chunks/dep-e9841b9e.mjs';\nimport '../_chunks/dep-49aeee3c.mjs';\nimport '../_chunks/dep-b5bf85f5.mjs';\nimport '../_chunks/dep-ec0bbd9f.mjs';\nimport '../_chunks/dep-732f0b7d.mjs';\nimport '../_chunks/dep-1b9718a2.mjs';\nimport '../_chunks/dep-e065dc25.mjs';\nimport '../_chunks/dep-400ec705.mjs';\nimport '../_chunks/dep-02f9394e.mjs';\nimport '../_chunks/dep-1725b1c7.mjs';\nimport '../_chunks/dep-532409c5.mjs';\nimport '../_common/js/global-config/default-config.mjs';\nimport '../_common/js/global-config/locale/zh_CN.mjs';\nimport '../_chunks/dep-9ed7da3e.mjs';\nimport '../_chunks/dep-7f65fc46.mjs';\nimport '../_chunks/dep-4f2cabb0.mjs';\nimport '../config-provider/type.mjs';\nimport '../hooks/useDefaultValue.mjs';\nimport '../hooks/useDestroyOnClose.mjs';\nimport '../hooks/useKeepAnimation.mjs';\nimport '../hooks/useRipple.mjs';\nimport '../utils/set-style.mjs';\nimport '../hooks/useVirtualScroll.mjs';\nimport '../hooks/useImagePreviewUrl.mjs';\nimport '../_common/js/upload/utils.mjs';\nimport '../_common/js/log/log.mjs';\nimport '../utils/easing.mjs';\nimport '../_chunks/dep-4a990ea3.mjs';\nimport '../hooks/useResizeObserver.mjs';\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nfunction _isSlot(s) {\n  return typeof s === 'function' || Object.prototype.toString.call(s) === '[object Object]' && !isVNode(s);\n}\nvar POPUP_ATTR_NAME = \"data-td-popup\";\nvar POPUP_PARENT_ATTR_NAME = \"data-td-popup-parent\";\nfunction getPopperTree(id, upwards) {\n  var list = [];\n  var selectors = [POPUP_PARENT_ATTR_NAME, POPUP_ATTR_NAME];\n  if (!id) return list;\n  if (upwards) {\n    selectors.unshift(selectors.pop());\n  }\n  recurse(id);\n  return list;\n  function recurse(id2) {\n    var children = document.querySelectorAll(\"[\".concat(selectors[0], \"=\\\"\").concat(id2, \"\\\"]\"));\n    children.forEach(function (el) {\n      list.push(el);\n      var childId = el.getAttribute(selectors[1]);\n      if (childId && childId !== id2) {\n        recurse(childId);\n      }\n    });\n  }\n}\nvar parentKey = Symbol();\nfunction getPopperPlacement(placement) {\n  return placement.replace(/-(left|top)$/, \"-start\").replace(/-(right|bottom)$/, \"-end\");\n}\nfunction attachListeners(elm) {\n  var offs = [];\n  return {\n    add: function add(type, listener) {\n      if (!type) return;\n      on(elm.value, type, listener);\n      offs.push(function () {\n        off(elm.value, type, listener);\n      });\n    },\n    clean: function clean() {\n      offs.forEach(function (handler) {\n        return handler === null || handler === void 0 ? void 0 : handler();\n      });\n      offs.length = 0;\n    }\n  };\n}\nvar _Popup = defineComponent({\n  name: \"TPopup\",\n  props: _objectSpread(_objectSpread({}, popupProps), {}, {\n    expandAnimation: {\n      type: Boolean\n    }\n  }),\n  setup: function setup(props2, _ref) {\n    var _process$env;\n    var expose = _ref.expose;\n    var _toRefs = toRefs(props2),\n      propVisible = _toRefs.visible,\n      modelValue = _toRefs.modelValue;\n    var _useVModel = useVModel(propVisible, modelValue, props2.defaultVisible, props2.onVisibleChange, \"visible\"),\n      _useVModel2 = _slicedToArray(_useVModel, 2),\n      visible = _useVModel2[0],\n      setVisible = _useVModel2[1];\n    var renderTNodeJSX = useTNodeJSX();\n    var renderContent = useContent();\n    var popper;\n    var showTimeout;\n    var hideTimeout;\n    var triggerEl = ref(null);\n    var overlayEl = ref(null);\n    var popperEl = ref(null);\n    var containerRef = ref(null);\n    var isOverlayHover = ref(false);\n    var id = typeof process !== \"undefined\" && (_process$env = process.env) !== null && _process$env !== void 0 && _process$env.TEST ? \"\" : Date.now().toString(36);\n    var parent = inject(parentKey, void 0);\n    provide(parentKey, {\n      id: id,\n      assertMouseLeave: onMouseLeave\n    });\n    var prefixCls = usePrefixClass(\"popup\");\n    var _useCommonClassName = useCommonClassName(),\n      commonCls = _useCommonClassName.STATUS;\n    var delay = computed(function () {\n      var _props2$delay, _delay2$;\n      var delay2 = props2.trigger !== \"hover\" ? [0, 0] : [].concat((_props2$delay = props2.delay) !== null && _props2$delay !== void 0 ? _props2$delay : [250, 150]);\n      return {\n        show: delay2[0],\n        hide: (_delay2$ = delay2[1]) !== null && _delay2$ !== void 0 ? _delay2$ : delay2[0]\n      };\n    });\n    var trigger = attachListeners(triggerEl);\n    watch(function () {\n      return [props2.trigger, triggerEl.value];\n    }, function () {\n      if (!triggerEl.value) return;\n      trigger.clean();\n      trigger.add({\n        hover: \"mouseenter\",\n        focus: \"focusin\",\n        \"context-menu\": \"contextmenu\",\n        click: \"click\"\n      }[props2.trigger], function (ev) {\n        if (props2.disabled) return;\n        if (ev.type === \"contextmenu\") {\n          ev.preventDefault();\n        }\n        if ((ev.type === \"click\" || ev.type === \"contextmenu\") && visible.value) {\n          hide(ev);\n          return;\n        }\n        show(ev);\n      });\n      trigger.add({\n        hover: \"mouseleave\",\n        focus: \"focusout\"\n      }[props2.trigger], hide);\n    });\n    watch(function () {\n      return [props2.overlayStyle, props2.overlayInnerStyle, overlayEl.value];\n    }, function () {\n      updateOverlayInnerStyle();\n      updatePopper();\n    });\n    watch(function () {\n      return props2.placement;\n    }, function () {\n      destroyPopper();\n      updatePopper();\n    });\n    watch(function () {\n      return visible.value;\n    }, function (visible2) {\n      if (visible2) {\n        on(document, \"mousedown\", onDocumentMouseDown, true);\n        if (props2.trigger === \"focus\") {\n          once(triggerEl.value, \"keydown\", function (ev) {\n            var _process$env2;\n            var code = typeof process !== \"undefined\" && (_process$env2 = process.env) !== null && _process$env2 !== void 0 && _process$env2.TEST ? \"27\" : \"Escape\";\n            if (ev.code === code) {\n              hide(ev);\n            }\n          });\n        }\n        return;\n      }\n      off(document, \"mousedown\", onDocumentMouseDown, true);\n    });\n    onUnmounted(function () {\n      destroyPopper();\n      clearAllTimeout();\n      off(document, \"mousedown\", onDocumentMouseDown, true);\n    });\n    expose({\n      update: updatePopper,\n      getOverlay: function getOverlay() {\n        return overlayEl.value;\n      },\n      getOverlayState: function getOverlayState() {\n        return {\n          hover: isOverlayHover.value\n        };\n      },\n      close: function close() {\n        return hide();\n      }\n    });\n    function getOverlayStyle() {\n      var overlayStyle = props2.overlayStyle;\n      if (!triggerEl.value || !overlayEl.value) return;\n      if (isFunction_1(overlayStyle)) {\n        return overlayStyle(triggerEl.value, overlayEl.value);\n      }\n      if (isObject_1(overlayStyle)) {\n        return overlayStyle;\n      }\n    }\n    function updateOverlayInnerStyle() {\n      var overlayInnerStyle = props2.overlayInnerStyle;\n      if (!triggerEl.value || !overlayEl.value) return;\n      if (isFunction_1(overlayInnerStyle)) {\n        setStyle(overlayEl.value, overlayInnerStyle(triggerEl.value, overlayEl.value));\n      } else if (isObject_1(overlayInnerStyle)) {\n        setStyle(overlayEl.value, overlayInnerStyle);\n      }\n    }\n    function updatePopper() {\n      if (!popperEl.value || !visible.value) return;\n      if (popper) {\n        if (triggerEl.value.getRootNode() instanceof ShadowRoot) {\n          popper.state.elements.reference = triggerEl.value;\n          popper.update();\n        } else {\n          var rect = triggerEl.value.getBoundingClientRect();\n          var parent2 = triggerEl.value;\n          while (parent2 && parent2 !== document.body) {\n            parent2 = parent2.parentElement;\n          }\n          var isHidden = parent2 !== document.body || rect.width === 0 && rect.height === 0;\n          if (!isHidden) {\n            popper.state.elements.reference = triggerEl.value;\n            popper.update();\n          } else {\n            setVisible(false, {\n              trigger: getTriggerType({\n                type: \"mouseenter\"\n              })\n            });\n          }\n        }\n        return;\n      }\n      popper = createPopper(triggerEl.value, popperEl.value, _objectSpread({\n        placement: getPopperPlacement(props2.placement),\n        onFirstUpdate: function onFirstUpdate() {\n          nextTick(updatePopper);\n        }\n      }, props2.popperOptions));\n    }\n    function destroyPopper() {\n      if (popper) {\n        var _popper;\n        (_popper = popper) === null || _popper === void 0 || _popper.destroy();\n        popper = null;\n      }\n      if (props2.destroyOnClose) {\n        var _containerRef$value;\n        (_containerRef$value = containerRef.value) === null || _containerRef$value === void 0 || _containerRef$value.unmountContent();\n      }\n    }\n    function show(ev) {\n      clearAllTimeout();\n      showTimeout = setTimeout(function () {\n        setVisible(true, {\n          trigger: getTriggerType(ev)\n        });\n      }, delay.value.show);\n    }\n    function hide(ev) {\n      clearAllTimeout();\n      hideTimeout = setTimeout(function () {\n        setVisible(false, {\n          trigger: getTriggerType(ev),\n          e: ev\n        });\n      }, delay.value.hide);\n    }\n    function clearAllTimeout() {\n      clearTimeout(showTimeout);\n      clearTimeout(hideTimeout);\n    }\n    function getTriggerType(ev) {\n      switch (ev === null || ev === void 0 ? void 0 : ev.type) {\n        case \"mouseenter\":\n          return \"trigger-element-hover\";\n        case \"mouseleave\":\n          return \"trigger-element-hover\";\n        case \"focusin\":\n          return \"trigger-element-focus\";\n        case \"focusout\":\n          return \"trigger-element-blur\";\n        case \"click\":\n          return \"trigger-element-click\";\n        case \"context-menu\":\n        case \"keydown\":\n          return \"keydown-esc\";\n        case \"mousedown\":\n          return \"document\";\n        default:\n          return \"trigger-element-close\";\n      }\n    }\n    function onDocumentMouseDown(ev) {\n      var _popperEl$value, _triggerEl$value;\n      if ((_popperEl$value = popperEl.value) !== null && _popperEl$value !== void 0 && _popperEl$value.contains(ev.target)) {\n        return;\n      }\n      if ((_triggerEl$value = triggerEl.value) !== null && _triggerEl$value !== void 0 && _triggerEl$value.contains(ev.target)) {\n        return;\n      }\n      var activedPopper = getPopperTree(id).find(function (el) {\n        return el.contains(ev.target);\n      });\n      if (activedPopper && getPopperTree(activedPopper.getAttribute(POPUP_PARENT_ATTR_NAME), true).some(function (el) {\n        return el === popperEl.value;\n      })) {\n        return;\n      }\n      hide(ev);\n    }\n    function onMouseLeave(ev) {\n      isOverlayHover.value = false;\n      if (props2.trigger !== \"hover\" || triggerEl.value.contains(ev.target)) return;\n      var isCursorOverlaps = getPopperTree(id).some(function (el) {\n        var rect = el.getBoundingClientRect();\n        return ev.x > rect.x && ev.x < rect.x + rect.width && ev.y > rect.y && ev.y < rect.y + rect.height;\n      });\n      if (!isCursorOverlaps) {\n        hide(ev);\n        parent === null || parent === void 0 || parent.assertMouseLeave(ev);\n      }\n    }\n    function onMouseenter() {\n      isOverlayHover.value = true;\n      if (visible.value && props2.trigger === \"hover\") {\n        clearAllTimeout();\n      }\n    }\n    function onOverlayClick(e) {\n      var _props2$onOverlayClic;\n      (_props2$onOverlayClic = props2.onOverlayClick) === null || _props2$onOverlayClic === void 0 || _props2$onOverlayClic.call(props2, {\n        e: e\n      });\n    }\n    var updateScrollTop = inject(\"updateScrollTop\", void 0);\n    function handleOnScroll(e) {\n      var _props2$onScroll;\n      var _e$target = e.target,\n        scrollTop = _e$target.scrollTop,\n        clientHeight = _e$target.clientHeight,\n        scrollHeight = _e$target.scrollHeight;\n      var debounceOnScrollBottom = debounce_1(function (e2) {\n        var _props2$onScrollToBot;\n        return (_props2$onScrollToBot = props2.onScrollToBottom) === null || _props2$onScrollToBot === void 0 ? void 0 : _props2$onScrollToBot.call(props2, {\n          e: e2\n        });\n      }, 100);\n      if (clientHeight + Math.floor(scrollTop) === scrollHeight) {\n        debounceOnScrollBottom(e);\n      }\n      (_props2$onScroll = props2.onScroll) === null || _props2$onScroll === void 0 || _props2$onScroll.call(props2, {\n        e: e\n      });\n    }\n    watch(function () {\n      return [visible.value, overlayEl.value];\n    }, function () {\n      if (visible.value && overlayEl.value && updateScrollTop) {\n        updateScrollTop === null || updateScrollTop === void 0 || updateScrollTop(overlayEl.value);\n      }\n    });\n    return function () {\n      var content = renderTNodeJSX(\"content\");\n      var hidePopup = props2.hideEmptyPopup && [\"\", void 0, null].includes(content);\n      var overlay = visible.value || !props2.destroyOnClose ? withDirectives(createVNode(\"div\", mergeProps(_defineProperty(_defineProperty({}, POPUP_ATTR_NAME, id), POPUP_PARENT_ATTR_NAME, parent === null || parent === void 0 ? void 0 : parent.id), {\n        \"class\": [prefixCls.value, props2.overlayClassName],\n        \"ref\": function ref(ref2) {\n          return popperEl.value = ref2;\n        },\n        \"style\": [{\n          zIndex: props2.zIndex\n        }, getOverlayStyle(), hidePopup && {\n          visibility: \"hidden\"\n        }],\n        \"onClick\": onOverlayClick,\n        \"onMouseenter\": onMouseenter,\n        \"onMouseleave\": onMouseLeave\n      }), [createVNode(\"div\", {\n        \"class\": [\"\".concat(prefixCls.value, \"__content\"), _defineProperty(_defineProperty(_defineProperty({}, \"\".concat(prefixCls.value, \"__content--text\"), isString_1(props2.content)), \"\".concat(prefixCls.value, \"__content--arrow\"), props2.showArrow), commonCls.value.disabled, props2.disabled), props2.overlayInnerClassName],\n        \"ref\": overlayEl,\n        \"onScroll\": handleOnScroll\n      }, [content, props2.showArrow && createVNode(\"div\", {\n        \"class\": \"\".concat(prefixCls.value, \"__arrow\")\n      }, null)])]), [[vShow, visible.value]]) : null;\n      return createVNode(Container, {\n        \"ref\": function ref(ref2) {\n          return containerRef.value = ref2;\n        },\n        \"forwardRef\": function forwardRef(ref2) {\n          return triggerEl.value = ref2;\n        },\n        \"onContentMounted\": function onContentMounted() {\n          if (visible.value) {\n            updatePopper();\n            var timer = setTimeout(function () {\n              updateOverlayInnerStyle();\n              clearTimeout(timer);\n            }, 60);\n          }\n        },\n        \"onResize\": function onResize() {\n          if (visible.value) {\n            updatePopper();\n          }\n        },\n        \"visible\": visible.value,\n        \"attach\": props2.attach\n      }, {\n        content: function content() {\n          return createVNode(Transition, {\n            \"name\": \"\".concat(prefixCls.value, \"--animation\").concat(props2.expandAnimation ? \"-expand\" : \"\"),\n            \"appear\": true,\n            \"onEnter\": updatePopper,\n            \"onAfterLeave\": destroyPopper\n          }, _isSlot(overlay) ? overlay : {\n            \"default\": function _default() {\n              return [overlay];\n            }\n          });\n        },\n        \"default\": function _default() {\n          return renderContent(\"default\", \"triggerElement\");\n        }\n      });\n    };\n  }\n});\nexport { _Popup as default };","map":{"version":3,"names":["_isSlot","s","Object","prototype","toString","call","isVNode","POPUP_ATTR_NAME","POPUP_PARENT_ATTR_NAME","getPopperTree","id","upwards","list","selectors","unshift","pop","recurse","id2","children","document","querySelectorAll","concat","forEach","el","push","childId","getAttribute","parentKey","Symbol","getPopperPlacement","placement","replace","attachListeners","elm","offs","add","type","listener","on","value","off","clean","handler","length","_Popup","defineComponent","name","props","_objectSpread","popupProps","expandAnimation","Boolean","setup","props2","_ref","_process$env","expose","_toRefs","toRefs","propVisible","visible","modelValue","_useVModel","useVModel","defaultVisible","onVisibleChange","_useVModel2","_slicedToArray","setVisible","renderTNodeJSX","useTNodeJSX","renderContent","useContent","popper","showTimeout","hideTimeout","triggerEl","ref","overlayEl","popperEl","containerRef","isOverlayHover","process","env","TEST","Date","now","parent","inject","provide","assertMouseLeave","onMouseLeave","prefixCls","usePrefixClass","_useCommonClassName","useCommonClassName","commonCls","STATUS","delay","computed","_props2$delay","_delay2$","delay2","trigger","show","hide","watch","hover","focus","click","ev","disabled","preventDefault","overlayStyle","overlayInnerStyle","updateOverlayInnerStyle","updatePopper","destroyPopper","visible2","onDocumentMouseDown","once","_process$env2","code","onUnmounted","clearAllTimeout","update","getOverlay","getOverlayState","close","getOverlayStyle","isFunction_1","isObject_1","setStyle","getRootNode","ShadowRoot","state","elements","reference","rect","getBoundingClientRect","parent2","body","parentElement","isHidden","width","height","getTriggerType","createPopper","onFirstUpdate","nextTick","popperOptions","_popper","destroy","destroyOnClose","_containerRef$value","unmountContent","setTimeout","e","clearTimeout","_popperEl$value","_triggerEl$value","contains","target","activedPopper","find","some","isCursorOverlaps","x","y","onMouseenter","onOverlayClick","_props2$onOverlayClic","updateScrollTop","handleOnScroll","_props2$onScroll","_e$target","scrollTop","clientHeight","scrollHeight","debounceOnScrollBottom","debounce_1","e2","_props2$onScrollToBot","onScrollToBottom","Math","floor","onScroll","content","hidePopup","hideEmptyPopup","includes","overlay","withDirectives","createVNode","mergeProps","_defineProperty","overlayClassName","ref2","zIndex","visibility","isString_1","showArrow","overlayInnerClassName","vShow","Container","forwardRef","onContentMounted","timer","onResize","attach","_default"],"sources":["../../src/popup/popup.tsx"],"sourcesContent":["import { createPopper, Placement } from '@popperjs/core';\nimport isFunction from 'lodash/isFunction';\nimport isObject from 'lodash/isObject';\nimport debounce from 'lodash/debounce';\nimport isString from 'lodash/isString';\nimport {\n  computed,\n  defineComponent,\n  inject,\n  InjectionKey,\n  nextTick,\n  onUnmounted,\n  provide,\n  ref,\n  Ref,\n  toRefs,\n  Transition,\n  watch,\n} from 'vue';\nimport { useContent, useTNodeJSX } from '../hooks';\nimport { useCommonClassName, usePrefixClass } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport { off, on, once } from '../utils/dom';\nimport setStyle from '../_common/js/utils/set-style';\nimport Container from './container';\nimport props from './props';\nimport { PopupTriggerEvent, TdPopupProps } from './type';\n\nconst POPUP_ATTR_NAME = 'data-td-popup';\nconst POPUP_PARENT_ATTR_NAME = 'data-td-popup-parent';\n\n/**\n * @param id\n * @param upwards query upwards poppers\n */\nfunction getPopperTree(id: number | string, upwards?: boolean): Element[] {\n  const list = [] as any;\n  const selectors = [POPUP_PARENT_ATTR_NAME, POPUP_ATTR_NAME];\n\n  if (!id) return list;\n  if (upwards) {\n    selectors.unshift(selectors.pop());\n  }\n\n  recurse(id);\n\n  return list;\n\n  function recurse(id: number | string) {\n    const children = document.querySelectorAll(`[${selectors[0]}=\"${id}\"]`);\n    children.forEach((el) => {\n      list.push(el);\n      const childId = el.getAttribute(selectors[1]);\n      if (childId && childId !== id) {\n        recurse(childId);\n      }\n    });\n  }\n}\n\nconst parentKey = Symbol() as InjectionKey<{\n  id: string;\n  assertMouseLeave: (ev: MouseEvent) => void;\n}>;\n\nfunction getPopperPlacement(placement: TdPopupProps['placement']): Placement {\n  return placement.replace(/-(left|top)$/, '-start').replace(/-(right|bottom)$/, '-end') as Placement;\n}\n\nfunction attachListeners(elm: Ref<Element>) {\n  const offs: Array<() => void> = [];\n  return {\n    add<K extends keyof HTMLElementEventMap>(type: K, listener: (ev: HTMLElementEventMap[K]) => void) {\n      if (!type) return;\n      on(elm.value, type, listener);\n      offs.push(() => {\n        off(elm.value, type, listener);\n      });\n    },\n    clean() {\n      offs.forEach((handler) => handler?.());\n      offs.length = 0;\n    },\n  };\n}\n\nexport default defineComponent({\n  name: 'TPopup',\n\n  props: {\n    ...props,\n    expandAnimation: {\n      type: Boolean,\n    },\n  },\n  setup(props, { expose }) {\n    const { visible: propVisible, modelValue } = toRefs(props);\n    const [visible, setVisible] = useVModel(\n      propVisible,\n      modelValue,\n      props.defaultVisible,\n      props.onVisibleChange,\n      'visible',\n    );\n    const renderTNodeJSX = useTNodeJSX();\n    const renderContent = useContent();\n\n    /** popperjs instance */\n    let popper: ReturnType<typeof createPopper>;\n    /** timeout id */\n    let showTimeout: any;\n    let hideTimeout: any;\n\n    const triggerEl = ref<HTMLElement>(null);\n    const overlayEl = ref<HTMLElement>(null);\n    const popperEl = ref<HTMLElement>(null);\n    const containerRef = ref<typeof Container>(null);\n    const isOverlayHover = ref(false);\n\n    const id = typeof process !== 'undefined' && process.env?.TEST ? '' : Date.now().toString(36);\n    const parent = inject(parentKey, undefined);\n\n    provide(parentKey, {\n      id,\n      assertMouseLeave: onMouseLeave,\n    });\n\n    const prefixCls = usePrefixClass('popup');\n    const { STATUS: commonCls } = useCommonClassName();\n    const delay = computed(() => {\n      const delay = props.trigger !== 'hover' ? [0, 0] : [].concat(props.delay ?? [250, 150]);\n      return {\n        show: delay[0],\n        hide: delay[1] ?? delay[0],\n      };\n    });\n\n    const trigger = attachListeners(triggerEl);\n\n    watch(\n      () => [props.trigger, triggerEl.value],\n      () => {\n        if (!triggerEl.value) return;\n        trigger.clean();\n\n        trigger.add(\n          (\n            {\n              hover: 'mouseenter',\n              focus: 'focusin',\n              'context-menu': 'contextmenu',\n              click: 'click',\n            } as any\n          )[props.trigger],\n          (ev: MouseEvent) => {\n            if (props.disabled) return;\n\n            if (ev.type === 'contextmenu') {\n              ev.preventDefault();\n            }\n\n            if ((ev.type === 'click' || ev.type === 'contextmenu') && visible.value) {\n              hide(ev);\n              return;\n            }\n\n            show(ev);\n          },\n        );\n\n        trigger.add(\n          (\n            {\n              hover: 'mouseleave',\n              focus: 'focusout',\n            } as any\n          )[props.trigger],\n          hide,\n        );\n      },\n    );\n\n    watch(\n      () => [props.overlayStyle, props.overlayInnerStyle, overlayEl.value],\n      () => {\n        updateOverlayInnerStyle();\n        updatePopper();\n      },\n    );\n\n    watch(\n      () => props.placement,\n      () => {\n        destroyPopper();\n        updatePopper();\n      },\n    );\n\n    watch(\n      () => visible.value,\n      (visible) => {\n        if (visible) {\n          on(document, 'mousedown', onDocumentMouseDown, true);\n          if (props.trigger === 'focus') {\n            once(triggerEl.value, 'keydown', (ev: KeyboardEvent) => {\n              const code = typeof process !== 'undefined' && process.env?.TEST ? '27' : 'Escape';\n              if (ev.code === code) {\n                hide(ev);\n              }\n            });\n          }\n          return;\n        }\n        off(document, 'mousedown', onDocumentMouseDown, true);\n      },\n    );\n\n    onUnmounted(() => {\n      destroyPopper();\n      clearAllTimeout();\n      off(document, 'mousedown', onDocumentMouseDown, true);\n    });\n\n    expose({\n      update: updatePopper,\n      getOverlay: () => overlayEl.value,\n      getOverlayState: () => ({\n        hover: isOverlayHover.value,\n      }),\n      /** close is going to be deprecated. visible is enough */\n      close: () => hide(),\n    });\n\n    function getOverlayStyle() {\n      const { overlayStyle } = props;\n\n      if (!triggerEl.value || !overlayEl.value) return;\n      if (isFunction(overlayStyle)) {\n        return overlayStyle(triggerEl.value, overlayEl.value);\n      }\n      if (isObject(overlayStyle)) {\n        return overlayStyle;\n      }\n    }\n\n    function updateOverlayInnerStyle() {\n      const { overlayInnerStyle } = props;\n\n      if (!triggerEl.value || !overlayEl.value) return;\n      if (isFunction(overlayInnerStyle)) {\n        setStyle(overlayEl.value, overlayInnerStyle(triggerEl.value, overlayEl.value));\n      } else if (isObject(overlayInnerStyle)) {\n        setStyle(overlayEl.value, overlayInnerStyle);\n      }\n    }\n\n    function updatePopper() {\n      if (!popperEl.value || !visible.value) return;\n      if (popper) {\n        /**\n         * web component 内的元素限制在了shadow root内，\n         * 无法通过寻找父元素的方式判定是否在当前文档内\n         */\n        if (triggerEl.value.getRootNode() instanceof ShadowRoot) {\n          popper.state.elements.reference = triggerEl.value;\n          popper.update();\n        } else {\n          const rect = triggerEl.value.getBoundingClientRect();\n          let parent = triggerEl.value;\n          while (parent && parent !== document.body) {\n            parent = parent.parentElement;\n          }\n          const isHidden = parent !== document.body || (rect.width === 0 && rect.height === 0);\n          if (!isHidden) {\n            popper.state.elements.reference = triggerEl.value;\n            popper.update();\n          } else {\n            setVisible(false, { trigger: getTriggerType({ type: 'mouseenter' } as MouseEvent) });\n          }\n        }\n        return;\n      }\n\n      popper = createPopper(triggerEl.value, popperEl.value, {\n        placement: getPopperPlacement(props.placement),\n        onFirstUpdate: () => {\n          nextTick(updatePopper);\n        },\n        ...props.popperOptions,\n      });\n    }\n\n    function destroyPopper() {\n      if (popper) {\n        popper?.destroy();\n        popper = null;\n      }\n      if (props.destroyOnClose) {\n        containerRef.value?.unmountContent();\n      }\n    }\n\n    function show(ev: PopupTriggerEvent) {\n      clearAllTimeout();\n      showTimeout = setTimeout(() => {\n        setVisible(true, { trigger: getTriggerType(ev) });\n      }, delay.value.show);\n    }\n\n    function hide(ev?: PopupTriggerEvent) {\n      clearAllTimeout();\n      hideTimeout = setTimeout(() => {\n        setVisible(false, { trigger: getTriggerType(ev), e: ev });\n      }, delay.value.hide);\n    }\n\n    function clearAllTimeout() {\n      clearTimeout(showTimeout);\n      clearTimeout(hideTimeout);\n    }\n\n    function getTriggerType(ev?: PopupTriggerEvent) {\n      switch (ev?.type) {\n        case 'mouseenter':\n          return 'trigger-element-hover';\n        case 'mouseleave':\n          return 'trigger-element-hover';\n        case 'focusin':\n          return 'trigger-element-focus';\n        case 'focusout':\n          return 'trigger-element-blur';\n        case 'click':\n          return 'trigger-element-click';\n        case 'context-menu':\n        case 'keydown':\n          return 'keydown-esc';\n        case 'mousedown':\n          return 'document';\n        default:\n          return 'trigger-element-close';\n      }\n    }\n\n    function onDocumentMouseDown(ev: MouseEvent) {\n      // click content\n      if (popperEl.value?.contains(ev.target as Node)) {\n        return;\n      }\n\n      // click trigger element\n      if (triggerEl.value?.contains(ev.target as Node)) {\n        return;\n      }\n\n      // ignore upwards\n      const activedPopper = getPopperTree(id).find((el) => el.contains(ev.target as Node));\n      if (\n        activedPopper &&\n        getPopperTree(activedPopper.getAttribute(POPUP_PARENT_ATTR_NAME), true).some((el) => el === popperEl.value)\n      ) {\n        return;\n      }\n\n      hide(ev);\n    }\n\n    function onMouseLeave(ev: MouseEvent) {\n      isOverlayHover.value = false;\n      if (props.trigger !== 'hover' || triggerEl.value.contains(ev.target as Node)) return;\n\n      const isCursorOverlaps = getPopperTree(id).some((el) => {\n        const rect = el.getBoundingClientRect();\n\n        return ev.x > rect.x && ev.x < rect.x + rect.width && ev.y > rect.y && ev.y < rect.y + rect.height;\n      });\n      if (!isCursorOverlaps) {\n        hide(ev);\n        parent?.assertMouseLeave(ev);\n      }\n    }\n\n    function onMouseenter() {\n      isOverlayHover.value = true;\n      if (visible.value && props.trigger === 'hover') {\n        clearAllTimeout();\n      }\n    }\n\n    function onOverlayClick(e: MouseEvent) {\n      props.onOverlayClick?.({ e });\n    }\n\n    const updateScrollTop = inject('updateScrollTop', undefined);\n\n    function handleOnScroll(e: WheelEvent) {\n      const { scrollTop, clientHeight, scrollHeight } = e.target as HTMLDivElement;\n\n      // 防止多次触发添加截流\n      const debounceOnScrollBottom = debounce((e) => props.onScrollToBottom?.({ e }), 100);\n\n      // windows 下 scrollTop 会出现小数，这里取整\n      if (clientHeight + Math.floor(scrollTop) === scrollHeight) {\n        // touch bottom\n        debounceOnScrollBottom(e);\n      }\n      props.onScroll?.({ e });\n    }\n    watch(\n      () => [visible.value, overlayEl.value],\n      () => {\n        if (visible.value && overlayEl.value && updateScrollTop) {\n          updateScrollTop?.(overlayEl.value);\n        }\n      },\n    );\n\n    return () => {\n      const content = renderTNodeJSX('content');\n      const hidePopup = props.hideEmptyPopup && ['', undefined, null].includes(content);\n\n      const overlay =\n        visible.value || !props.destroyOnClose ? (\n          <div\n            {...{\n              [POPUP_ATTR_NAME]: id,\n              [POPUP_PARENT_ATTR_NAME]: parent?.id,\n            }}\n            class={[prefixCls.value, props.overlayClassName]}\n            ref={(ref: HTMLElement) => (popperEl.value = ref)}\n            style={[{ zIndex: props.zIndex }, getOverlayStyle(), hidePopup && { visibility: 'hidden' }]}\n            vShow={visible.value}\n            onClick={onOverlayClick}\n            onMouseenter={onMouseenter}\n            onMouseleave={onMouseLeave}\n          >\n            <div\n              class={[\n                `${prefixCls.value}__content`,\n                {\n                  [`${prefixCls.value}__content--text`]: isString(props.content),\n                  [`${prefixCls.value}__content--arrow`]: props.showArrow,\n                  [commonCls.value.disabled]: props.disabled,\n                },\n                props.overlayInnerClassName,\n              ]}\n              ref={overlayEl}\n              onScroll={handleOnScroll}\n            >\n              {content}\n              {props.showArrow && <div class={`${prefixCls.value}__arrow`} />}\n            </div>\n          </div>\n        ) : null;\n\n      return (\n        <Container\n          ref={(ref: any) => (containerRef.value = ref)}\n          forwardRef={(ref) => (triggerEl.value = ref)}\n          onContentMounted={() => {\n            if (visible.value) {\n              updatePopper();\n\n              const timer = setTimeout(() => {\n                /** compted after animation finished */\n                updateOverlayInnerStyle();\n                clearTimeout(timer);\n              }, 60);\n            }\n          }}\n          onResize={() => {\n            if (visible.value) {\n              updatePopper();\n            }\n          }}\n          visible={visible.value}\n          attach={props.attach}\n        >\n          {{\n            content: () => (\n              <Transition\n                name={`${prefixCls.value}--animation${props.expandAnimation ? '-expand' : ''}`}\n                appear\n                onEnter={updatePopper}\n                onAfterLeave={destroyPopper}\n              >\n                {overlay}\n              </Transition>\n            ),\n            default: () => renderContent('default', 'triggerElement'),\n          }}\n        </Container>\n      );\n    };\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}